import{b as W,r as d,u as z,j as s,L as $}from"./index-BAQHcCZP.js";import{u as Y,a as Q}from"./useGetAllTasks-eeHFWHDl.js";import{u as K}from"./useGetLead-KAXV2kDf.js";import{u as X}from"./useGetEmployee-BqYzJ_c6.js";import{S as q,G as J,L as Z}from"./search-Dfyka3uh.js";import{I as ss}from"./info-OoKR4taG.js";import{E as T}from"./external-link-CGWYGP1X.js";import{X as y}from"./x-Br0VJ280.js";const es="_header_1s2ox_11",as="_title_1s2ox_25",ts="_headerActions_1s2ox_37",ns="_searchContainer_1s2ox_49",os="_searchIcon_1s2ox_59",is="_searchInput_1s2ox_75",cs="_emptyState_1s2ox_149",ls="_infoButton_1s2ox_343",ds="_detailItem_1s2ox_417",rs="_detailLabel_1s2ox_439",ms="_detailValue_1s2ox_449",_s="_modalOverlay_1s2ox_501",us="_modal_1s2ox_501",xs="_modalHeader_1s2ox_549",Ns="_closeButton_1s2ox_583",hs="_infoContent_1s2ox_803",js="_infoItem_1s2ox_811",fs="_infoLabel_1s2ox_823",Ls="_infoValue_1s2ox_835",vs="_tasksPage_1s2ox_1057",Is="_viewToggle_1s2ox_1169",Cs="_viewButton_1s2ox_1183",ks="_activeView_1s2ox_1217",Es="_tasksContainer_1s2ox_1239",ps="_taskCard_1s2ox_1251",Ts="_tasksListContainer_1s2ox_1283",Ss="_taskListItem_1s2ox_1295",bs="_taskListHeader_1s2ox_1327",Ds="_taskListHeaderLeft_1s2ox_1341",Bs="_taskListContent_1s2ox_1353",gs="_taskListDetails_1s2ox_1365",ws="_overdueTask_1s2ox_1375",Os="_todayTask_1s2ox_1383",As="_taskHeader_1s2ox_1391",Ms="_taskDate_1s2ox_1407",Vs="_taskContent_1s2ox_1457",$s="_taskName_1s2ox_1465",ys="_taskDetails_1s2ox_1479",Hs="_linkButton_1s2ox_1523",Rs="_linkIcon_1s2ox_1557",Fs="_actionButton_1s2ox_1565",Ps="_taskFooter_1s2ox_1601",Gs="_taskStatus_1s2ox_1613",Us="_upcoming_1s2ox_1627",Ws="_today_1s2ox_1383",zs="_overdue_1s2ox_1375",Ys="_infoSection_1s2ox_1797",Qs="_notesBox_1s2ox_1855",Ks="_modalFooter_1s2ox_1871",Xs="_closeModalButton_1s2ox_1887",qs="_viewLeadButton_1s2ox_1917",e={header:es,title:as,headerActions:ts,searchContainer:ns,searchIcon:os,searchInput:is,emptyState:cs,infoButton:ls,detailItem:ds,detailLabel:rs,detailValue:ms,modalOverlay:_s,modal:us,modalHeader:xs,closeButton:Ns,infoContent:hs,infoItem:js,infoLabel:fs,infoValue:Ls,tasksPage:vs,viewToggle:Is,viewButton:Cs,activeView:ks,tasksContainer:Es,taskCard:ps,tasksListContainer:Ts,taskListItem:Ss,taskListHeader:bs,taskListHeaderLeft:Ds,taskListContent:Bs,taskListDetails:gs,overdueTask:ws,todayTask:Os,taskHeader:As,taskDate:Ms,taskContent:Vs,taskName:$s,taskDetails:ys,linkButton:Hs,linkIcon:Rs,actionButton:Fs,taskFooter:Ps,taskStatus:Gs,upcoming:Us,today:Ws,overdue:zs,infoSection:Ys,notesBox:Qs,modalFooter:Ks,closeModalButton:Xs,viewLeadButton:qs},Js={NEW:"جديد",CONTACTED:"تم التواصل",INTERESTED:"مهتم",VISITING:"زيارة",MEETING:"اجتماع",NEGOTIATING:"تفاوض",QUALIFIED:"مؤهل",CLOSED_WON:"تم الإغلاق (نجاح)",CLOSED_LOST:"تم الإغلاق (خسارة)",FOLLOW_UP:"متابعة"},Zs={CALLBACK_REQUESTED:"طلب معاودة الاتصال",NO_ANSWER:"لا يوجد رد",WRONG_NUMBER:"رقم خاطئ",HIGH_INTEREST:"اهتمام عالي",MEDIUM_INTEREST:"اهتمام متوسط",LOW_INTEREST:"اهتمام منخفض",SCHEDULED:"مجدول",COMPLETED:"مكتمل",CANCELLED:"ملغي",PRICE_DISCUSSION:"مناقشة السعر",PAYMENT_PLAN:"خطة الدفع",FINAL_OFFER:"العرض النهائي",READY_TO_BUY:"جاهز للشراء",NEEDS_FINANCING:"يحتاج تمويل",CONSIDERING_OPTIONS:"يدرس الخيارات",FULL_PAYMENT:"دفع كامل",INSTALLMENT_PLAN:"خطة أقساط",PRICE_ISSUE:"مشكلة في السعر",LOCATION_ISSUE:"مشكلة في الموقع",COMPETITOR:"ذهب لمنافس",NOT_INTERESTED:"غير مهتم",OTHER:"أخرى",PENDING:"قيد الانتظار"},se={WEBSITE:"الموقع الإلكتروني",SOCIAL_MEDIA:"وسائل التواصل الاجتماعي",REFERRAL:"إحالة",COLD_CALL:"اتصال مباشر",EXHIBITION:"معرض",WALK_IN:"زيارة مباشرة",SALES:"فريق المبيعات",PARTNER:"شريك",OTHER:"أخرى"},de=()=>{const j=W(),[f,H]=d.useState([]),[L,v]=d.useState([]),[R,S]=d.useState(!0),[x,F]=d.useState(""),[I,b]=d.useState("cards"),[o,D]=d.useState(null),[P,B]=d.useState(!1),[G,g]=d.useState(!1),[c,w]=d.useState(null),[U,O]=d.useState(!1),{employee:n}=z(),{execute:A}=Y(),{execute:M}=Q(),{execute:C}=K(),{execute:V}=X();d.useEffect(()=>{(async()=>{try{S(!0);let t=[];(n==null?void 0:n.role)==="ADMIN"?t=await M():n!=null&&n.id&&(t=await A(Number.parseInt(n.id)));const i=await Promise.all(t.map(async l=>{const m={...l};if(l.customer_id)try{const r=await C(l.customer_id);m.customerName=r.name}catch(r){console.error("Error fetching customer:",r),m.customerName=`عميل ${l.customer_id}`}if(l.sales_id&&(n==null?void 0:n.role)==="ADMIN")try{const r=await V(l.sales_id);m.salesName=r.name}catch(r){console.error("Error fetching sales:",r),m.salesName=`مندوب ${l.sales_id}`}return m.actionDetails=l.action_id?`إجراء ${l.action_id}`:"لا يوجد إجراء مرتبط",m}));H(i),v(i)}catch(t){console.error("Error loading tasks:",t)}finally{S(!1)}})()},[n==null?void 0:n.id,n==null?void 0:n.role,A,M,C,V]),d.useEffect(()=>{if(x){const a=x.toLowerCase(),t=f.filter(i=>{var l,m,r;return i.name.toLowerCase().includes(a)||((l=i.customerName)==null?void 0:l.toLowerCase().includes(a))||((m=i.salesName)==null?void 0:m.toLowerCase().includes(a))||((r=i.actionDetails)==null?void 0:r.toLowerCase().includes(a))});v(t)}else v(f)},[x,f]);const k=a=>{D(a),B(!0)},E=async(a,t)=>{t.stopPropagation();try{O(!0);const i=await C(a);w(i),g(!0)}catch(i){console.error("Error fetching customer details:",i)}finally{O(!1)}},p=(a,t,i)=>{i.stopPropagation(),j(t?`/leads/${a}?actionId=${t}`:`/leads/${a}`)},h=()=>{B(!1),g(!1),D(null),w(null)},N=a=>{if(!a)return"غير محدد";const t=new Date(a);return new Intl.DateTimeFormat("ar-EG",{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric"}).format(t)},_=a=>{if(!a)return!1;const t=new Date;return new Date(a)<t},u=a=>{if(!a)return!1;const t=new Date,i=new Date(a);return i.getDate()===t.getDate()&&i.getMonth()===t.getMonth()&&i.getFullYear()===t.getFullYear()};return s.jsxs("div",{className:e.tasksPage,children:[s.jsxs("div",{className:e.header,children:[s.jsx("h1",{className:e.title,children:"المهام القادمة"}),s.jsxs("div",{className:e.headerActions,children:[s.jsxs("div",{className:e.searchContainer,children:[s.jsx(q,{size:18,className:e.searchIcon}),s.jsx("input",{type:"text",placeholder:"بحث...",value:x,onChange:a=>F(a.target.value),className:e.searchInput})]}),s.jsxs("div",{className:e.viewToggle,children:[s.jsx("button",{className:`${e.viewButton} ${I==="cards"?e.activeView:""}`,onClick:()=>b("cards"),"aria-label":"عرض البطاقات",children:s.jsx(J,{size:18})}),s.jsx("button",{className:`${e.viewButton} ${I==="list"?e.activeView:""}`,onClick:()=>b("list"),"aria-label":"عرض القائمة",children:s.jsx(Z,{size:18})})]})]})]}),R?s.jsx($,{isVisible:!0}):L.length===0?s.jsx("div",{className:e.emptyState,children:x?s.jsx("p",{children:"لا توجد نتائج مطابقة للبحث"}):s.jsx("p",{children:"لا توجد مهام قادمة"})}):I==="cards"?s.jsx("div",{className:e.tasksContainer,children:L.map(a=>s.jsxs("div",{className:`${e.taskCard} ${_(a.due_date)?e.overdueTask:u(a.due_date)?e.todayTask:""}`,onClick:()=>k(a),children:[s.jsxs("div",{className:e.taskHeader,children:[s.jsx("div",{className:e.taskDate,children:N(a.due_date)}),s.jsx("button",{className:e.infoButton,onClick:t=>{t.stopPropagation(),k(a)},"aria-label":"معلومات",children:s.jsx(ss,{size:18})})]}),s.jsxs("div",{className:e.taskContent,children:[s.jsx("h3",{className:e.taskName,children:a.name}),s.jsxs("div",{className:e.taskDetails,children:[a.customer_id&&s.jsxs("div",{className:e.detailItem,children:[s.jsx("span",{className:e.detailLabel,children:"العميل:"}),s.jsx("button",{className:e.linkButton,onClick:t=>E(a.customer_id,t),children:a.customerName||`عميل ${a.customer_id}`})]}),(n==null?void 0:n.role)==="ADMIN"&&a.sales_id&&s.jsxs("div",{className:e.detailItem,children:[s.jsx("span",{className:e.detailLabel,children:"المندوب:"}),s.jsx("span",{className:e.detailValue,children:a.salesName||`مندوب ${a.sales_id}`})]}),a.action_id&&a.customer_id&&s.jsxs("div",{className:e.detailItem,children:[s.jsx("span",{className:e.detailLabel,children:"الإجراء:"}),s.jsxs("button",{className:e.linkButton,onClick:t=>p(a.customer_id,a.action_id,t),children:["عرض الإجراء ",s.jsx(T,{size:14,className:e.linkIcon})]})]})]})]}),s.jsx("div",{className:e.taskFooter,children:s.jsx("div",{className:`${e.taskStatus} ${_(a.due_date)?e.overdue:u(a.due_date)?e.today:e.upcoming}`,children:_(a.due_date)?"متأخر":u(a.due_date)?"اليوم":"قادم"})})]},a.id))}):s.jsx("div",{className:e.tasksListContainer,children:L.map(a=>s.jsxs("div",{className:`${e.taskListItem} ${_(a.due_date)?e.overdueTask:u(a.due_date)?e.todayTask:""}`,onClick:()=>k(a),children:[s.jsxs("div",{className:e.taskListHeader,children:[s.jsxs("div",{className:e.taskListHeaderLeft,children:[s.jsx("h3",{className:e.taskName,children:a.name}),s.jsx("div",{className:`${e.taskStatus} ${_(a.due_date)?e.overdue:u(a.due_date)?e.today:e.upcoming}`,children:_(a.due_date)?"متأخر":u(a.due_date)?"اليوم":"قادم"})]}),s.jsx("div",{className:e.taskDate,children:N(a.due_date)})]}),s.jsxs("div",{className:e.taskListContent,children:[s.jsxs("div",{className:e.taskListDetails,children:[a.customer_id&&s.jsxs("div",{className:e.detailItem,children:[s.jsx("span",{className:e.detailLabel,children:"العميل:"}),s.jsx("button",{className:e.linkButton,onClick:t=>E(a.customer_id,t),children:a.customerName||`عميل ${a.customer_id}`})]}),(n==null?void 0:n.role)==="ADMIN"&&a.sales_id&&s.jsxs("div",{className:e.detailItem,children:[s.jsx("span",{className:e.detailLabel,children:"المندوب:"}),s.jsx("span",{className:e.detailValue,children:a.salesName||`مندوب ${a.sales_id}`})]})]}),a.action_id&&a.customer_id&&s.jsxs("button",{className:e.actionButton,onClick:t=>p(a.customer_id,a.action_id,t),children:["عرض الإجراء ",s.jsx(T,{size:14,className:e.linkIcon})]})]})]},a.id))}),P&&o&&s.jsx("div",{className:e.modalOverlay,children:s.jsxs("div",{className:e.modal,children:[s.jsxs("div",{className:e.modalHeader,children:[s.jsx("h2",{children:"تفاصيل المهمة"}),s.jsx("button",{className:e.closeButton,onClick:h,children:s.jsx(y,{size:20})})]}),s.jsxs("div",{className:e.infoContent,children:[s.jsxs("div",{className:e.infoSection,children:[s.jsx("h3",{children:"معلومات أساسية"}),s.jsxs("div",{className:e.infoItem,children:[s.jsx("span",{className:e.infoLabel,children:"اسم المهمة:"}),s.jsx("span",{className:e.infoValue,children:o.name})]}),s.jsxs("div",{className:e.infoItem,children:[s.jsx("span",{className:e.infoLabel,children:"تاريخ الاستحقاق:"}),s.jsx("span",{className:`${e.infoValue} ${_(o.due_date)?e.overdue:u(o.due_date)?e.today:""}`,children:N(o.due_date)})]}),s.jsxs("div",{className:e.infoItem,children:[s.jsx("span",{className:e.infoLabel,children:"تاريخ الإنشاء:"}),s.jsx("span",{className:e.infoValue,children:N(o.created_at)})]}),s.jsxs("div",{className:e.infoItem,children:[s.jsx("span",{className:e.infoLabel,children:"آخر تحديث:"}),s.jsx("span",{className:e.infoValue,children:N(o.updated_at)})]})]}),s.jsxs("div",{className:e.infoSection,children:[s.jsx("h3",{children:"العلاقات"}),o.customer_id&&s.jsxs("div",{className:e.infoItem,children:[s.jsx("span",{className:e.infoLabel,children:"العميل:"}),s.jsx("button",{className:e.linkButton,onClick:a=>E(o.customer_id,a),children:o.customerName||`عميل ${o.customer_id}`})]}),(n==null?void 0:n.role)==="ADMIN"&&o.sales_id&&s.jsxs("div",{className:e.infoItem,children:[s.jsx("span",{className:e.infoLabel,children:"المندوب:"}),s.jsx("span",{className:e.infoValue,children:o.salesName||`مندوب ${o.sales_id}`})]}),o.action_id&&o.customer_id&&s.jsxs("div",{className:e.infoItem,children:[s.jsx("span",{className:e.infoLabel,children:"الإجراء:"}),s.jsxs("button",{className:e.linkButton,onClick:a=>p(o.customer_id,o.action_id,a),children:["عرض الإجراء ",s.jsx(T,{size:14,className:e.linkIcon})]})]})]})]}),s.jsx("div",{className:e.modalFooter,children:s.jsx("button",{className:e.closeModalButton,onClick:h,children:"إغلاق"})})]})}),G&&c&&s.jsx("div",{className:e.modalOverlay,children:s.jsxs("div",{className:e.modal,children:[s.jsxs("div",{className:e.modalHeader,children:[s.jsx("h2",{children:"معلومات العميل"}),s.jsx("button",{className:e.closeButton,onClick:h,children:s.jsx(y,{size:20})})]}),s.jsx("div",{className:e.infoContent,children:U?s.jsx($,{isVisible:!0}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:e.infoSection,children:[s.jsx("h3",{children:"معلومات أساسية"}),s.jsxs("div",{className:e.infoItem,children:[s.jsx("span",{className:e.infoLabel,children:"الاسم:"}),s.jsx("span",{className:e.infoValue,children:c.name})]}),s.jsxs("div",{className:e.infoItem,children:[s.jsx("span",{className:e.infoLabel,children:"رقم الهاتف:"}),s.jsx("span",{className:e.infoValue,children:c.number})]}),s.jsxs("div",{className:e.infoItem,children:[s.jsx("span",{className:e.infoLabel,children:"العنوان:"}),s.jsx("span",{className:e.infoValue,children:c.address||"غير محدد"})]}),s.jsxs("div",{className:e.infoItem,children:[s.jsx("span",{className:e.infoLabel,children:"المصدر:"}),s.jsx("span",{className:e.infoValue,children:se[c.source]||c.source})]}),s.jsxs("div",{className:e.infoItem,children:[s.jsx("span",{className:e.infoLabel,children:"الميزانية:"}),s.jsx("span",{className:e.infoValue,children:c.budget?`${c.budget} ج.م`:"غير محدد"})]})]}),s.jsxs("div",{className:e.infoSection,children:[s.jsx("h3",{children:"الحالة"}),s.jsxs("div",{className:e.infoItem,children:[s.jsx("span",{className:e.infoLabel,children:"الحالة:"}),s.jsx("span",{className:e.infoValue,children:Js[c.state]||c.state})]}),c.substate&&s.jsxs("div",{className:e.infoItem,children:[s.jsx("span",{className:e.infoLabel,children:"الحالة الفرعية:"}),s.jsx("span",{className:e.infoValue,children:Zs[c.substate]||c.substate})]})]}),c.notes&&s.jsxs("div",{className:e.infoSection,children:[s.jsx("h3",{children:"ملاحظات"}),s.jsx("div",{className:e.notesBox,children:c.notes})]})]})}),s.jsxs("div",{className:e.modalFooter,children:[s.jsx("button",{className:e.viewLeadButton,onClick:()=>j(`/leads/${c.id}`),children:"عرض صفحة العميل"}),s.jsx("button",{className:e.closeModalButton,onClick:h,children:"إغلاق"})]})]})})]})};export{de as default};
