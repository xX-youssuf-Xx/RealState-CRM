import{c as y,r as l,d as Le,u as Ce,j as e,L as de}from"./index-BAQHcCZP.js";import{u as be}from"./useGetLead-KAXV2kDf.js";import{u as Te}from"./useGetEmployee-BqYzJ_c6.js";import{u as ke,a as De}from"./useUpdateProject-7LPhNO78.js";import{u as Oe,a as Be}from"./useUpdateUnit-D0z3yDc_.js";import{S as Ae,G as ye,L as Ge}from"./search-Dfyka3uh.js";import{P as ue}from"./plus-2IGcsAYH.js";import{I as me}from"./info-OoKR4taG.js";import{c as Fe,X as Z}from"./x-Br0VJ280.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pe=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],V=Fe("arrow-right",Pe),Me=()=>{const{isLoading:v,error:m,data:j,setError:r,_execute:_}=y(),S=l.useCallback(async(p,w={})=>{try{return await _(`actions/customer/${p}`,"GET",null,w)}catch(N){throw r(N),N}},[_,r]);return{isLoading:v,error:m,data:j,execute:S,setError:r}},Re=()=>{const{isLoading:v,error:m,data:j,setError:r,_execute:_}=y(),S=l.useCallback(async(p,w={})=>{try{return await _(`projects/${p}`,"GET",null,w)}catch(N){throw r(N),N}},[_,r]);return{isLoading:v,error:m,data:j,execute:S,setError:r}},Ue=()=>{const{isLoading:v,error:m,data:j,setError:r,_execute:_}=y(),S=l.useCallback(async(p,w={})=>{try{return await _(`units/${p}`,"GET",null,w)}catch(N){throw r(N),N}},[_,r]);return{isLoading:v,error:m,data:j,execute:S,setError:r}},We=()=>{const{isLoading:v,error:m,data:j,setError:r,_execute:_}=y(),S=l.useCallback(async(p,w,N,T,g,k,f,D,H,G={})=>{try{return await _("actions","POST",{customer_id:p,sales_id:w,project_id:f,unit_id:D,prev_state:N,prev_substate:g,new_state:T,new_substate:k,notes:H},G)}catch(O){throw r(O),O}},[_,r]);return{isLoading:v,error:m,data:j,execute:S,setError:r}},Ve=()=>{const{isLoading:v,error:m,data:j,setError:r,_execute:_}=y(),S=l.useCallback(async(p,w,N,T,g,k={})=>{try{return await _("tasks","POST",{name:p,customer_id:w,sales_id:N,action_id:T,due_date:g},k)}catch(f){throw r(f),f}},[_,r]);return{isLoading:v,error:m,data:j,execute:S,setError:r}},He="_actionsPage_rgwhk_1",qe="_header_rgwhk_11",$e="_title_rgwhk_25",ze="_headerActions_rgwhk_37",Ye="_searchContainer_rgwhk_49",Qe="_searchIcon_rgwhk_59",Ke="_searchInput_rgwhk_75",Xe="_viewToggle_rgwhk_105",Ze="_viewButton_rgwhk_119",Je="_activeView_rgwhk_153",es="_addButton_rgwhk_173",ss="_emptyState_rgwhk_219",ts="_actionsContainer_rgwhk_247",as="_actionCard_rgwhk_259",ns="_actionsListContainer_rgwhk_287",os="_actionListItem_rgwhk_299",cs="_actionListHeader_rgwhk_325",rs="_actionListContent_rgwhk_343",is="_actionListDetails_rgwhk_359",ls="_detailsRow_rgwhk_367",ds="_actionHeader_rgwhk_381",us="_actionDate_rgwhk_399",ms="_infoButton_rgwhk_409",hs="_actionContent_rgwhk_437",_s="_actionStatusFlow_rgwhk_445",Ns="_stateBox_rgwhk_463",xs="_successState_rgwhk_485",js="_dangerState_rgwhk_495",ps="_activeState_rgwhk_505",ws="_stateName_rgwhk_515",Ss="_substateName_rgwhk_527",Is="_arrowIcon_rgwhk_537",vs="_actionDetails_rgwhk_547",gs="_detailItem_rgwhk_559",fs="_detailLabel_rgwhk_571",Es="_detailValue_rgwhk_581",Ls="_notesItem_rgwhk_589",Cs="_notesText_rgwhk_597",bs="_modalOverlay_rgwhk_615",Ts="_modal_rgwhk_615",ks="_modalHeader_rgwhk_663",Ds="_closeButton_rgwhk_697",Os="_infoContent_rgwhk_727",Bs="_infoSection_rgwhk_735",As="_infoItem_rgwhk_759",ys="_infoLabel_rgwhk_767",Gs="_infoValue_rgwhk_781",Fs="_stateChangeInfo_rgwhk_793",Ps="_stateInfoBox_rgwhk_805",Ms="_prevStateBox_rgwhk_821",Rs="_newStateBox_rgwhk_831",Us="_arrowIconLarge_rgwhk_853",Ws="_notesBox_rgwhk_865",Vs="_modalFooter_rgwhk_881",Hs="_closeModalButton_rgwhk_897",qs="_form_rgwhk_929",$s="_formSection_rgwhk_937",zs="_stateChangeForm_rgwhk_961",Ys="_stateFormGroup_rgwhk_973",Qs="_stateSelect_rgwhk_997",Ks="_substateSelect_rgwhk_999",Xs="_substateGroup_rgwhk_1045",Zs="_formGroup_rgwhk_1053",Js="_formInput_rgwhk_1075",et="_formTextarea_rgwhk_1103",st="_requiredMark_rgwhk_1137",tt="_cancelButton_rgwhk_1147",at="_submitButton_rgwhk_1189",s={actionsPage:He,header:qe,title:$e,headerActions:ze,searchContainer:Ye,searchIcon:Qe,searchInput:Ke,viewToggle:Xe,viewButton:Ze,activeView:Je,addButton:es,emptyState:ss,actionsContainer:ts,actionCard:as,actionsListContainer:ns,actionListItem:os,actionListHeader:cs,actionListContent:rs,actionListDetails:is,detailsRow:ls,actionHeader:ds,actionDate:us,infoButton:ms,actionContent:hs,actionStatusFlow:_s,stateBox:Ns,successState:xs,dangerState:js,activeState:ps,stateName:ws,substateName:Ss,arrowIcon:Is,actionDetails:vs,detailItem:gs,detailLabel:fs,detailValue:Es,notesItem:Ls,notesText:Cs,modalOverlay:bs,modal:Ts,modalHeader:ks,closeButton:Ds,infoContent:Os,infoSection:Bs,infoItem:As,infoLabel:ys,infoValue:Gs,stateChangeInfo:Fs,stateInfoBox:Ps,prevStateBox:Ms,newStateBox:Rs,arrowIconLarge:Us,notesBox:Ws,modalFooter:Vs,closeModalButton:Hs,form:qs,formSection:$s,stateChangeForm:zs,stateFormGroup:Ys,stateSelect:Qs,substateSelect:Ks,substateGroup:Xs,formGroup:Zs,formInput:Js,formTextarea:et,requiredMark:st,cancelButton:tt,submitButton:at},ht=()=>{var re,ie;const{leadId:v}=Le(),m=Number.parseInt(v||"0",10),{employee:j}=Ce(),r=(j==null?void 0:j.role)==="ADMIN",[_,S]=l.useState([]),[p,w]=l.useState([]),[N,T]=l.useState(!0),[g,k]=l.useState(""),[f,D]=l.useState("cards"),[H,G]=l.useState(!1),[O,q]=l.useState(!1),[u,J]=l.useState(null),[c,he]=l.useState(null),[_e,ee]=l.useState([]),[se,$]=l.useState([]),[E,te]=l.useState(null),[n,L]=l.useState({salesId:0,prevState:"NEW",prevSubstate:"",newState:"NEW",newSubstate:"",projectId:null,unitId:null,notes:""}),[Ne,B]=l.useState(!1),[F,P]=l.useState({name:"",dueDate:"",dueTime:"10:00"}),{execute:xe}=Ve(),{execute:z,isLoading:je}=Me(),{execute:ae}=be(),{execute:Y}=Te(),{execute:M}=Re(),{execute:Q}=Ue(),{execute:K}=ke(),{execute:pe}=Oe(),{execute:we,isLoading:X}=We(),{execute:Se}=Be(),{execute:Ie}=De();l.useEffect(()=>{(async()=>{try{if(m){const a=await ae(m);he(a);const x=await z(m),h=await Promise.all(x.map(async o=>{const d={...o};try{if(o.sales_id){const i=await Y(o.sales_id);d.salesName=i.name}if(o.project_id){const i=await M(o.project_id);d.projectName=i.name}if(o.unit_id){const i=await Q(o.unit_id);d.unitName=i.name}d.leadName=a.name}catch(i){console.error("Error fetching action details:",i)}return d}));if(S(h),w(h),h.length>0){const o=[...h].sort((d,i)=>new Date(i.created_at).getTime()-new Date(d.created_at).getTime());te(o[0])}const b=await K();ee(b),L(o=>({...o,salesId:a.sales_id??0}))}}catch(a){console.error("Error loading lead data:",a)}finally{T(!1)}})()},[m,z,ae,Y,M,Q,K]),l.useEffect(()=>{let t=[..._];if(g){const a=g.toLowerCase();t=t.filter(x=>{var h,b,o,d,i,W,le;return((h=x.notes)==null?void 0:h.toLowerCase().includes(a))||((b=x.leadName)==null?void 0:b.toLowerCase().includes(a))||((o=x.salesName)==null?void 0:o.toLowerCase().includes(a))||((d=x.projectName)==null?void 0:d.toLowerCase().includes(a))||((i=x.unitName)==null?void 0:i.toLowerCase().includes(a))||((W=I[x.new_state])==null?void 0:W.toLowerCase().includes(a))||((le=I[x.prev_state])==null?void 0:le.toLowerCase().includes(a))})}w(t)},[g,_]);const ve=async t=>{if(L(a=>({...a,projectId:t,unitId:null})),t)try{const x=(await pe(t)).filter(h=>h.status!=="SOLD");$(x)}catch(a){console.error("Error fetching units:",a),$([])}else $([])},ge=t=>{if(L(x=>({...x,newState:t,newSubstate:""})),["VISITING","MEETING","FOLLOW_UP"].includes(t)){const x={VISITING:"زيارة للعميل",MEETING:"اجتماع مع العميل",FOLLOW_UP:"متابعة مع العميل"},h=new Date;h.setDate(h.getDate()+1);const b=h.toISOString().split("T")[0];P({name:x[t],dueDate:b,dueTime:"10:00"})}},ne=t=>{J(t),G(!0)},oe=()=>{E?L(t=>({...t,prevState:E.new_state||"",prevSubstate:E.new_substate||"",salesId:(c==null?void 0:c.sales_id)||0})):c!=null&&c.state&&L(t=>({...t,prevState:c.state||"",prevSubstate:c.substate||"",salesId:c.sales_id||0})),q(!0)},A=()=>{G(!1),q(!1),B(!1),J(null)},fe=async t=>{t.preventDefault();try{if(!m||!n.salesId)throw new Error("Missing required fields");if(n.newState==="CLOSED_WON"&&(!n.projectId||!n.unitId)){alert("يجب اختيار المشروع والوحدة عند إغلاق الصفقة بنجاح");return}if(["VISITING","MEETING","FOLLOW_UP"].includes(n.newState)){B(!0);return}await ce()}catch(a){console.error("Error creating action:",a),alert("حدث خطأ أثناء إنشاء الإجراء")}},ce=async t=>{const a=await we(m,n.salesId,n.prevState,n.newState,n.prevSubstate,n.newSubstate,n.projectId||void 0,n.unitId||void 0,n.notes||void 0);if(t){const o=`${t.dueDate}T${t.dueTime}:00Z`;await xe(t.name,m,n.salesId,a.id,o)}if(n.newState==="CLOSED_WON"&&n.unitId&&n.projectId){const o=new Date().toISOString().split("T")[0];await Se(n.unitId,void 0,void 0,void 0,void 0,void 0,"SOLD",o);const d=new FormData,W=((await M(n.projectId)).sold_count||0)+1;d.append("sold_count",W.toString()),await Ie(n.projectId,d)}const x=await z(m),h=await Promise.all(x.map(async o=>{const d={...o};try{if(o.sales_id){const i=await Y(o.sales_id);d.salesName=i.name}if(o.project_id){const i=await M(o.project_id);d.projectName=i.name}if(o.unit_id){const i=await Q(o.unit_id);d.unitName=i.name}d.leadName=(c==null?void 0:c.name)||""}catch(i){console.error("Error fetching action details:",i)}return d}));if(S(h),w(h),h.length>0){const o=[...h].sort((d,i)=>new Date(i.created_at).getTime()-new Date(d.created_at).getTime());te(o[0])}L({salesId:(c==null?void 0:c.sales_id)||0,prevState:(E==null?void 0:E.new_state)||(c==null?void 0:c.state)||"NEW",prevSubstate:(E==null?void 0:E.new_substate)||(c==null?void 0:c.substate)||"",newState:"NEW",newSubstate:"",projectId:null,unitId:null,notes:""}),A();const b=await K();ee(b)},Ee=async t=>{t.preventDefault();try{await ce(F),B(!1)}catch(a){console.error("Error creating task:",a),alert("حدث خطأ أثناء إنشاء المهمة")}},R=t=>{const a=new Date(t);return new Intl.DateTimeFormat("ar-EG",{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric"}).format(a)},I={NEW:" جديد ",CONTACTED:" تم التواصل ",INTERESTED:" مهتم ",VISITING:" زيارة ",MEETING:" اجتماع ",NEGOTIATING:" تفاوض ",QUALIFIED:" مؤهل ",CLOSED_WON:" تم الإغلاق (نجاح) ",CLOSED_LOST:" تم الإغلاق (خسارة) ",FOLLOW_UP:" متابعة "},U={NEW:[],CONTACTED:["CALLBACK_REQUESTED","NO_ANSWER","WRONG_NUMBER"],INTERESTED:["HIGH_INTEREST","MEDIUM_INTEREST","LOW_INTEREST"],VISITING:["SCHEDULED","COMPLETED","CANCELLED"],MEETING:["SCHEDULED","COMPLETED","CANCELLED"],NEGOTIATING:["PRICE_DISCUSSION","PAYMENT_PLAN","FINAL_OFFER"],QUALIFIED:["READY_TO_BUY","NEEDS_FINANCING","CONSIDERING_OPTIONS"],CLOSED_WON:["FULL_PAYMENT","INSTALLMENT_PLAN"],CLOSED_LOST:["PRICE_ISSUE","LOCATION_ISSUE","COMPETITOR","NOT_INTERESTED","OTHER"],FOLLOW_UP:["SCHEDULED","PENDING"]},C={CALLBACK_REQUESTED:"طلب معاودة الاتصال ",NO_ANSWER:"لا يوجد رد ",WRONG_NUMBER:"رقم خاطئ ",HIGH_INTEREST:"اهتمام عالي ",MEDIUM_INTEREST:"اهتمام متوسط ",LOW_INTEREST:"اهتمام منخفض ",SCHEDULED:"مجدول ",COMPLETED:"مكتمل ",CANCELLED:"ملغي ",PRICE_DISCUSSION:"مناقشة السعر ",PAYMENT_PLAN:"خطة الدفع ",FINAL_OFFER:"العرض النهائي ",READY_TO_BUY:"جاهز للشراء ",NEEDS_FINANCING:"يحتاج تمويل ",CONSIDERING_OPTIONS:"يدرس الخيارات ",FULL_PAYMENT:"دفع كامل ",INSTALLMENT_PLAN:"خطة أقساط ",PRICE_ISSUE:"مشكلة في السعر ",LOCATION_ISSUE:"مشكلة في الموقع ",COMPETITOR:"ذهب لمنافس ",NOT_INTERESTED:"غير مهتم ",OTHER:"أخرى ",PENDING:"قيد الانتظار "};return e.jsxs("div",{className:s.actionsPage,children:[e.jsxs("div",{className:s.header,children:[e.jsxs("h1",{className:s.title,children:["إجراءات العميل: ",c==null?void 0:c.name]}),e.jsxs("div",{className:s.headerActions,children:[e.jsxs("div",{className:s.searchContainer,children:[e.jsx(Ae,{size:18,className:s.searchIcon}),e.jsx("input",{type:"text",placeholder:"بحث...",value:g,onChange:t=>k(t.target.value),className:s.searchInput})]}),e.jsxs("div",{className:s.viewToggle,children:[e.jsx("button",{className:`${s.viewButton} ${f==="cards"?s.activeView:""}`,onClick:()=>D("cards"),"aria-label":"عرض البطاقات",children:e.jsx(ye,{size:18})}),e.jsx("button",{className:`${s.viewButton} ${f==="list"?s.activeView:""}`,onClick:()=>D("list"),"aria-label":"عرض القائمة",children:e.jsx(Ge,{size:18})})]}),e.jsxs("button",{className:s.addButton,onClick:oe,children:[e.jsx(ue,{size:18}),e.jsx("span",{children:"إضافة إجراء"})]})]})]}),N?e.jsx(de,{isVisible:!0}):p.length===0?e.jsx("div",{className:s.emptyState,children:g?e.jsx("p",{children:"لا توجد نتائج مطابقة للبحث"}):e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"لا توجد إجراءات مسجلة لهذا العميل"}),e.jsxs("button",{className:s.addButton,onClick:oe,children:[e.jsx(ue,{size:18}),e.jsx("span",{children:"إضافة إجراء"})]})]})}):f==="cards"?e.jsx("div",{className:s.actionsContainer,children:p.map(t=>e.jsxs("div",{className:s.actionCard,children:[e.jsxs("div",{className:s.actionHeader,children:[e.jsx("div",{className:s.actionDate,children:R(t.created_at.toString())}),e.jsx("button",{className:s.infoButton,onClick:()=>ne(t),"aria-label":"معلومات",children:e.jsx(me,{size:18})})]}),e.jsxs("div",{className:s.actionContent,children:[e.jsxs("div",{className:s.actionStatusFlow,children:[e.jsxs("div",{className:s.stateBox,children:[e.jsx("span",{className:s.stateName,children:I[t.prev_state||"NEW"]}),t.prev_substate&&e.jsx("span",{className:s.substateName,children:C[t.prev_substate]})]}),e.jsx(V,{className:s.arrowIcon,size:20}),e.jsxs("div",{className:`${s.stateBox} ${t.new_state==="CLOSED_WON"?s.successState:t.new_state==="CLOSED_LOST"?s.dangerState:s.activeState}`,children:[e.jsx("span",{className:s.stateName,children:I[t.new_state||"NEW"]}),t.new_substate&&e.jsx("span",{className:s.substateName,children:C[t.new_substate]})]})]}),e.jsxs("div",{className:s.actionDetails,children:[r&&e.jsxs("div",{className:s.detailItem,children:[e.jsx("span",{className:s.detailLabel,children:"المندوب:"}),e.jsx("span",{className:s.detailValue,children:t.salesName||"غير محدد"})]}),t.project_id&&e.jsxs("div",{className:s.detailItem,children:[e.jsx("span",{className:s.detailLabel,children:"المشروع:"}),e.jsx("span",{className:s.detailValue,children:t.projectName||"غير محدد"})]}),t.unit_id&&e.jsxs("div",{className:s.detailItem,children:[e.jsx("span",{className:s.detailLabel,children:"الوحدة:"}),e.jsx("span",{className:s.detailValue,children:t.unitName||"غير محدد"})]}),t.notes&&e.jsxs("div",{className:s.notesItem,children:[e.jsx("span",{className:s.detailLabel,children:"ملاحظات:"}),e.jsx("span",{className:s.notesText,children:t.notes})]})]})]})]},t.id))}):e.jsx("div",{className:s.actionsListContainer,children:p.map(t=>e.jsxs("div",{className:s.actionListItem,children:[e.jsxs("div",{className:s.actionListHeader,children:[e.jsx("div",{className:s.actionDate,children:R(t.created_at.toString())}),e.jsx("button",{className:s.infoButton,onClick:()=>ne(t),"aria-label":"معلومات",children:e.jsx(me,{size:18})})]}),e.jsxs("div",{className:s.actionListContent,children:[e.jsxs("div",{className:s.actionStatusFlow,children:[e.jsxs("div",{className:s.stateBox,children:[e.jsx("span",{className:s.stateName,children:I[t.prev_state||"NEW"]}),t.prev_substate&&e.jsx("span",{className:s.substateName,children:C[t.prev_substate]})]}),e.jsx(V,{className:s.arrowIcon,size:20}),e.jsxs("div",{className:`${s.stateBox} ${t.new_state==="CLOSED_WON"?s.successState:t.new_state==="CLOSED_LOST"?s.dangerState:s.activeState}`,children:[e.jsx("span",{className:s.stateName,children:I[t.new_state||"NEW"]}),t.new_substate&&e.jsx("span",{className:s.substateName,children:C[t.new_substate]})]})]}),e.jsxs("div",{className:s.actionListDetails,children:[e.jsxs("div",{className:s.detailsRow,children:[r&&e.jsxs("div",{className:s.detailItem,children:[e.jsx("span",{className:s.detailLabel,children:"المندوب:"}),e.jsx("span",{className:s.detailValue,children:t.salesName||"غير محدد"})]}),t.project_id&&e.jsxs("div",{className:s.detailItem,children:[e.jsx("span",{className:s.detailLabel,children:"المشروع:"}),e.jsx("span",{className:s.detailValue,children:t.projectName||"غير محدد"})]}),t.unit_id&&e.jsxs("div",{className:s.detailItem,children:[e.jsx("span",{className:s.detailLabel,children:"الوحدة:"}),e.jsx("span",{className:s.detailValue,children:t.unitName||"غير محدد"})]})]}),t.notes&&e.jsxs("div",{className:s.notesItem,children:[e.jsx("span",{className:s.detailLabel,children:"ملاحظات:"}),e.jsx("span",{className:s.notesText,children:t.notes})]})]})]})]},t.id))}),H&&u&&e.jsx("div",{className:s.modalOverlay,children:e.jsxs("div",{className:s.modal,children:[e.jsxs("div",{className:s.modalHeader,children:[e.jsx("h2",{children:"تفاصيل الإجراء"}),e.jsx("button",{className:s.closeButton,onClick:A,children:e.jsx(Z,{size:20})})]}),e.jsxs("div",{className:s.infoContent,children:[e.jsxs("div",{className:s.infoSection,children:[e.jsx("h3",{children:"معلومات أساسية"}),e.jsxs("div",{className:s.infoItem,children:[e.jsx("span",{className:s.infoLabel,children:"رقم الإجراء:"}),e.jsx("span",{className:s.infoValue,children:u.id})]}),r&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:s.infoItem,children:[e.jsx("span",{className:s.infoLabel,children:"العميل:"}),e.jsx("span",{className:s.infoValue,children:u.leadName||"غير محدد"})]}),e.jsxs("div",{className:s.infoItem,children:[e.jsx("span",{className:s.infoLabel,children:"المندوب:"}),e.jsx("span",{className:s.infoValue,children:u.salesName||"غير محدد"})]})]}),e.jsxs("div",{className:s.infoItem,children:[e.jsx("span",{className:s.infoLabel,children:"تاريخ الإنشاء:"}),e.jsx("span",{className:s.infoValue,children:R(u.created_at.toString())})]}),e.jsxs("div",{className:s.infoItem,children:[e.jsx("span",{className:s.infoLabel,children:"آخر تحديث:"}),e.jsx("span",{className:s.infoValue,children:R(u.updated_at.toString())})]})]}),e.jsxs("div",{className:s.infoSection,children:[e.jsx("h3",{children:"تغيير الحالة"}),e.jsxs("div",{className:s.stateChangeInfo,children:[e.jsxs("div",{className:`${s.stateInfoBox} ${s.prevStateBox}`,children:[e.jsx("h4",{children:"الحالة السابقة"}),e.jsx("span",{className:s.stateName,children:I[u.prev_state||"NEW"]}),u.prev_substate&&e.jsx("span",{className:s.substateName,children:C[u.prev_substate]})]}),e.jsx(V,{className:s.arrowIconLarge,size:32}),e.jsxs("div",{className:`${s.stateInfoBox} ${s.newStateBox}`,children:[e.jsx("h4",{children:"الحالة الجديدة"}),e.jsx("span",{className:s.stateName,children:I[u.new_state||"NEW"]}),u.new_substate&&e.jsx("span",{className:s.substateName,children:C[u.new_substate]})]})]})]}),(u.project_id||u.unit_id)&&e.jsxs("div",{className:s.infoSection,children:[e.jsx("h3",{children:"معلومات العقار"}),u.project_id&&e.jsxs("div",{className:s.infoItem,children:[e.jsx("span",{className:s.infoLabel,children:"المشروع:"}),e.jsx("span",{className:s.infoValue,children:u.projectName||"غير محدد"})]}),u.unit_id&&e.jsxs("div",{className:s.infoItem,children:[e.jsx("span",{className:s.infoLabel,children:"الوحدة:"}),e.jsx("span",{className:s.infoValue,children:u.unitName||"غير محدد"})]})]}),u.notes&&e.jsxs("div",{className:s.infoSection,children:[e.jsx("h3",{children:"ملاحظات"}),e.jsx("div",{className:s.notesBox,children:u.notes})]})]}),e.jsx("div",{className:s.modalFooter,children:e.jsx("button",{className:s.closeModalButton,onClick:A,children:"إغلاق"})})]})}),O&&e.jsx("div",{className:s.modalOverlay,children:e.jsxs("div",{className:s.modal,children:[e.jsxs("div",{className:s.modalHeader,children:[e.jsx("h2",{children:"إضافة إجراء جديد"}),e.jsx("button",{className:s.closeButton,onClick:A,children:e.jsx(Z,{size:20})})]}),e.jsxs("form",{onSubmit:fe,className:s.form,children:[e.jsxs("div",{className:s.formSection,children:[e.jsx("h3",{children:"الحالة"}),e.jsxs("div",{className:s.stateChangeForm,children:[e.jsxs("div",{className:s.stateFormGroup,children:[e.jsx("label",{children:"الحالة السابقة"}),e.jsx("select",{value:n.prevState,className:s.stateSelect,disabled:!0,children:Object.keys(I).map(t=>e.jsx("option",{value:t,children:I[t]},t))}),((re=U[n.prevState])==null?void 0:re.length)>0&&e.jsxs("div",{className:s.substateGroup,children:[e.jsx("label",{children:"الحالة الفرعية السابقة"}),e.jsxs("select",{value:n.prevSubstate,className:s.substateSelect,disabled:!0,children:[e.jsx("option",{value:"",children:"بدون حالة فرعية"}),U[n.prevState].map(t=>e.jsx("option",{value:t,children:C[t]},t))]})]})]}),e.jsx(V,{className:s.arrowIconLarge,size:32}),e.jsxs("div",{className:s.stateFormGroup,children:[e.jsx("label",{children:"الحالة الجديدة"}),e.jsx("select",{value:n.newState,onChange:t=>ge(t.target.value),className:s.stateSelect,required:!0,children:Object.keys(I).map(t=>e.jsx("option",{value:t,children:I[t]},t))}),((ie=U[n.newState])==null?void 0:ie.length)>0&&e.jsxs("div",{className:s.substateGroup,children:[e.jsx("label",{children:"الحالة الفرعية الجديدة"}),e.jsxs("select",{value:n.newSubstate,onChange:t=>L(a=>({...a,newSubstate:t.target.value})),className:s.substateSelect,children:[e.jsx("option",{value:"",children:"بدون حالة فرعية"}),U[n.newState].map(t=>e.jsx("option",{value:t,children:C[t]},t))]})]})]})]})]}),(n.newState==="CLOSED_WON"||n.newState==="NEGOTIATING"||n.newState==="QUALIFIED")&&e.jsxs("div",{className:s.formSection,children:[e.jsx("h3",{children:"معلومات العقار"}),e.jsxs("div",{className:s.formGroup,children:[e.jsxs("label",{htmlFor:"projectId",children:["المشروع ",n.newState==="CLOSED_WON"&&e.jsx("span",{className:s.requiredMark,children:"*"})]}),e.jsxs("select",{id:"projectId",value:n.projectId||"",onChange:t=>ve(t.target.value?Number.parseInt(t.target.value):0),className:s.formInput,required:n.newState==="CLOSED_WON",children:[e.jsx("option",{value:"",children:"اختر المشروع"}),_e.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),n.projectId&&e.jsxs("div",{className:s.formGroup,children:[e.jsxs("label",{htmlFor:"unitId",children:["الوحدة ",n.newState==="CLOSED_WON"&&e.jsx("span",{className:s.requiredMark,children:"*"})]}),e.jsxs("select",{id:"unitId",value:n.unitId||"",onChange:t=>L(a=>({...a,unitId:t.target.value?Number.parseInt(t.target.value):null})),className:s.formInput,required:n.newState==="CLOSED_WON",children:[e.jsx("option",{value:"",children:"اختر الوحدة"}),se.length>0?se.map(t=>e.jsxs("option",{value:t.id,children:[t.name," (",t.status,")"]},t.id)):e.jsx("option",{value:"",disabled:!0,children:"لا توجد وحدات متاحة"})]})]})]}),e.jsxs("div",{className:s.formSection,children:[e.jsx("h3",{children:"ملاحظات"}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{htmlFor:"notes",children:"ملاحظات"}),e.jsx("textarea",{id:"notes",value:n.notes,onChange:t=>L(a=>({...a,notes:t.target.value})),className:s.formTextarea,rows:4})]})]}),e.jsxs("div",{className:s.modalFooter,children:[e.jsx("button",{type:"button",className:s.cancelButton,onClick:A,disabled:X,children:"إلغاء"}),e.jsx("button",{type:"submit",className:s.submitButton,disabled:X,children:X||je?e.jsx(de,{isVisible:!0}):"إضافة إجراء"})]})]})]})}),Ne&&e.jsx("div",{className:s.modalOverlay,children:e.jsxs("div",{className:s.modal,children:[e.jsxs("div",{className:s.modalHeader,children:[e.jsx("h2",{children:"جدولة مهمة"}),e.jsx("button",{className:s.closeButton,onClick:()=>B(!1),children:e.jsx(Z,{size:20})})]}),e.jsxs("form",{onSubmit:Ee,className:s.form,children:[e.jsxs("div",{className:s.formSection,children:[e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{htmlFor:"taskName",children:"اسم المهمة"}),e.jsx("input",{id:"taskName",type:"text",value:F.name,onChange:t=>P(a=>({...a,name:t.target.value})),className:s.formInput,required:!0})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{htmlFor:"taskDate",children:"تاريخ المهمة"}),e.jsx("input",{id:"taskDate",type:"date",value:F.dueDate,onChange:t=>P(a=>({...a,dueDate:t.target.value})),className:s.formInput,required:!0})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{htmlFor:"taskTime",children:"وقت المهمة"}),e.jsx("input",{id:"taskTime",type:"time",value:F.dueTime,onChange:t=>P(a=>({...a,dueTime:t.target.value})),className:s.formInput,required:!0})]})]}),e.jsxs("div",{className:s.modalFooter,children:[e.jsx("button",{type:"button",className:s.cancelButton,onClick:()=>B(!1),children:"إلغاء"}),e.jsx("button",{type:"submit",className:s.submitButton,children:"إنشاء المهمة والإجراء"})]})]})]})})]})};export{ht as default};
