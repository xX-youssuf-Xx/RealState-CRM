import{c as z,r as u,u as Xe,y as I,j as e,L as P}from"./index-BVlH6NZv.js";import{S as ge,T as ve}from"./ReactToastify-CPXOJhfx.js";import{a as Je,u as Ze}from"./useGetAllLeads-D3G6kMXV.js";import{u as es}from"./useGetAllEmployees-BbW4x9VO.js";import{u as ss}from"./useGetEmployee-Mnpieq3t.js";import{S as ts,G as as,L as ns}from"./search-BtsNuTIg.js";import{F as ls}from"./funnel-C0YnbX2K.js";import{P as Ee}from"./plus-zPGu-Yu-.js";import{I as U}from"./info-Dihl10ME.js";import{c as Ae,X as te}from"./x-ByRfET2r.js";import{E as ae}from"./external-link-B_RBsIFe.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const is=[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]],ne=Ae("phone",is);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rs=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],Ce=Ae("user-plus",rs),os=()=>{const{isLoading:h,error:x,data:N,setError:m,_execute:_}=z(),g=u.useCallback(async(v,j,b,p,C,B,H,k,y,T,l={})=>{try{return await _("leads","POST",{name:v,number:j,source:b,address:p,state:C,substate:B,budget:H,notes:k,is_created_by_sales:y,notification_id:T},l)}catch(L){throw m(L),L}},[_,m]);return{isLoading:h,error:x,data:N,execute:g,setError:m}},cs=()=>{const{isLoading:h,error:x,data:N,setError:m,_execute:_}=z(),g=u.useCallback(async(v,j,b,p,C,B,H,k,y,T,l,L,c={})=>{try{const S={name:j,number:b,source:p,address:C,state:B,substate:H,sales_id:k,budget:y,notes:T,is_created_by_sales:l,notification_id:L};return await _(`leads/${v}`,"PATCH",S,c)}catch(S){throw m(S),S}},[_,m]);return{isLoading:h,error:x,data:N,execute:g,setError:m}},ds=()=>{const{isLoading:h,error:x,data:N,setError:m,_execute:_}=z(),g=u.useCallback(async(v,j={})=>{try{return await _(`leads/${v}`,"DELETE",null,j)}catch(b){throw m(b),b}},[_,m]);return{isLoading:h,error:x,data:N,execute:g,setError:m}},us=()=>{const{isLoading:h,error:x,data:N,setError:m,_execute:_}=z(),g=u.useCallback(async(v,j,b={})=>{try{const p={new_sales_id:j};return await _(`leads/${v}/transfer`,"PATCH",p,b)}catch(p){throw m(p),p}},[_,m]);return{isLoading:h,error:x,data:N,execute:g,setError:m}},ms="_leadsPage_5ke74_1",_s="_header_5ke74_11",hs="_title_5ke74_25",xs="_headerActions_5ke74_37",Ns="_searchContainer_5ke74_49",fs="_searchIcon_5ke74_59",js="_searchInput_5ke74_75",bs="_filterButton_5ke74_103",ps="_filterBadge_5ke74_141",Ls="_addButton_5ke74_161",Is="_filterIndicator_5ke74_207",Ss="_resetButton_5ke74_227",gs="_emptyState_5ke74_257",vs="_leadsGrid_5ke74_283",Es="_leadCard_5ke74_297",Cs="_newLead_5ke74_325",Bs="_contactedLead_5ke74_333",ks="_interestedLead_5ke74_341",Ts="_qualifiedLead_5ke74_349",As="_wonLead_5ke74_357",Os="_lostLead_5ke74_365",Ds="_leadHeader_5ke74_375",ws="_newHeader_5ke74_393",Fs="_contactedHeader_5ke74_401",Ms="_follow_upHeader_5ke74_403",Hs="_interestedHeader_5ke74_411",ys="_visitingHeader_5ke74_413",Gs="_meetingHeader_5ke74_415",$s="_negotiatingHeader_5ke74_425",Rs="_qualifiedHeader_5ke74_427",Ps="_closed_wonHeader_5ke74_435",Us="_closed_lostHeader_5ke74_443",Vs="_leadName_5ke74_451",zs="_actions_5ke74_463",Ws="_editButton_5ke74_473",qs="_deleteButton_5ke74_475",Qs="_infoButton_5ke74_477",Ys="_leadDetails_5ke74_545",Ks="_detailItem_5ke74_553",Xs="_detailLabel_5ke74_575",Js="_detailValue_5ke74_585",Zs="_phoneActions_5ke74_593",et="_phoneButtons_5ke74_605",st="_callButton_5ke74_615",tt="_whatsappButton_5ke74_617",at="_actionButtons_5ke74_673",nt="_transferButton_5ke74_685",lt="_detailsButton_5ke74_687",it="_newState_5ke74_795",rt="_contactedState_5ke74_805",ot="_follow_upState_5ke74_807",ct="_interestedState_5ke74_817",dt="_visitingState_5ke74_819",ut="_meetingState_5ke74_821",mt="_negotiatingState_5ke74_831",_t="_qualifiedState_5ke74_833",ht="_closed_wonState_5ke74_843",xt="_closed_lostState_5ke74_853",Nt="_modalOverlay_5ke74_865",ft="_modal_5ke74_865",jt="_modalHeader_5ke74_927",bt="_closeButton_5ke74_961",pt="_form_5ke74_1013",Lt="_filterForm_5ke74_1015",It="_formGroup_5ke74_1023",St="_formActions_5ke74_1083",gt="_filterActions_5ke74_1085",vt="_transferActions_5ke74_1087",Et="_cancelButton_5ke74_1101",Ct="_submitButton_5ke74_1143",Bt="_applyFilterButton_5ke74_1145",kt="_transferConfirmButton_5ke74_1147",Tt="_resetFilterButton_5ke74_1205",At="_infoModal_5ke74_1237",Ot="_infoContent_5ke74_1267",Dt="_infoSection_5ke74_1289",wt="_sectionTitle_5ke74_1305",Ft="_infoItem_5ke74_1321",Mt="_infoLabel_5ke74_1341",Ht="_infoValue_5ke74_1353",yt="_notesBox_5ke74_1361",Gt="_infoActions_5ke74_1377",$t="_closeInfoButton_5ke74_1391",Rt="_editInfoButton_5ke74_1393",Pt="_transferModal_5ke74_1429",Ut="_confirmModal_5ke74_1473",Vt="_confirmActions_5ke74_1517",zt="_deleteConfirmButton_5ke74_1529",Wt="_viewToggle_5ke74_1663",qt="_viewButton_5ke74_1675",Qt="_activeView_5ke74_1709",Yt="_leadsList_5ke74_1731",Kt="_leadListItem_5ke74_1743",Xt="_leadListHeader_5ke74_1771",Jt="_leadListContent_5ke74_1785",Zt="_leadListDetails_5ke74_1797",ea="_leadListActions_5ke74_1807",s={leadsPage:ms,header:_s,title:hs,headerActions:xs,searchContainer:Ns,searchIcon:fs,searchInput:js,filterButton:bs,filterBadge:ps,addButton:Ls,filterIndicator:Is,resetButton:Ss,emptyState:gs,leadsGrid:vs,leadCard:Es,newLead:Cs,contactedLead:Bs,interestedLead:ks,qualifiedLead:Ts,wonLead:As,lostLead:Os,leadHeader:Ds,newHeader:ws,contactedHeader:Fs,follow_upHeader:Ms,interestedHeader:Hs,visitingHeader:ys,meetingHeader:Gs,negotiatingHeader:$s,qualifiedHeader:Rs,closed_wonHeader:Ps,closed_lostHeader:Us,leadName:Vs,actions:zs,editButton:Ws,deleteButton:qs,infoButton:Qs,leadDetails:Ys,detailItem:Ks,detailLabel:Xs,detailValue:Js,phoneActions:Zs,phoneButtons:et,callButton:st,whatsappButton:tt,actionButtons:at,transferButton:nt,detailsButton:lt,newState:it,contactedState:rt,follow_upState:ot,interestedState:ct,visitingState:dt,meetingState:ut,negotiatingState:mt,qualifiedState:_t,closed_wonState:ht,closed_lostState:xt,modalOverlay:Nt,modal:ft,modalHeader:jt,closeButton:bt,form:pt,filterForm:Lt,formGroup:It,formActions:St,filterActions:gt,transferActions:vt,cancelButton:Et,submitButton:Ct,applyFilterButton:Bt,transferConfirmButton:kt,resetFilterButton:Tt,infoModal:At,infoContent:Ot,infoSection:Dt,sectionTitle:wt,infoItem:Ft,infoLabel:Mt,infoValue:Ht,notesBox:yt,infoActions:Gt,closeInfoButton:$t,editInfoButton:Rt,transferModal:Pt,confirmModal:Ut,confirmActions:Vt,deleteConfirmButton:zt,viewToggle:Wt,viewButton:qt,activeView:Qt,leadsList:Yt,leadListItem:Kt,leadListHeader:Xt,leadListContent:Jt,leadListDetails:Zt,leadListActions:ea},V={NEW:"جديد",CONTACTED:"تم التواصل",INTERESTED:"مهتم",VISITING:"زيارة",MEETING:"اجتماع",NEGOTIATING:"تفاوض",QUALIFIED:"مؤهل",CLOSED_WON:"تم الإغلاق (نجاح)",CLOSED_LOST:"تم الإغلاق (خسارة)",FOLLOW_UP:"متابعة"},M={NEW:[],CONTACTED:["CALLBACK_REQUESTED","NO_ANSWER","WRONG_NUMBER"],INTERESTED:["HIGH_INTEREST","MEDIUM_INTEREST","LOW_INTEREST"],VISITING:["SCHEDULED","COMPLETED","CANCELLED"],MEETING:["SCHEDULED","COMPLETED","CANCELLED"],NEGOTIATING:["PRICE_DISCUSSION","PAYMENT_PLAN","FINAL_OFFER"],QUALIFIED:["READY_TO_BUY","NEEDS_FINANCING","CONSIDERING_OPTIONS"],CLOSED_WON:["FULL_PAYMENT","INSTALLMENT_PLAN"],CLOSED_LOST:["PRICE_ISSUE","LOCATION_ISSUE","COMPETITOR","NOT_INTERESTED","OTHER"],FOLLOW_UP:["SCHEDULED","PENDING"]},le={CALLBACK_REQUESTED:"طلب معاودة الاتصال",NO_ANSWER:"لا يوجد رد",WRONG_NUMBER:"رقم خاطئ",HIGH_INTEREST:"اهتمام عالي",MEDIUM_INTEREST:"اهتمام متوسط",LOW_INTEREST:"اهتمام منخفض",SCHEDULED:"مجدول",COMPLETED:"مكتمل",CANCELLED:"ملغي",PRICE_DISCUSSION:"مناقشة السعر",PAYMENT_PLAN:"خطة الدفع",FINAL_OFFER:"العرض النهائي",READY_TO_BUY:"جاهز للشراء",NEEDS_FINANCING:"يحتاج تمويل",CONSIDERING_OPTIONS:"يدرس الخيارات",FULL_PAYMENT:"دفع كامل",INSTALLMENT_PLAN:"خطة أقساط",PRICE_ISSUE:"مشكلة في السعر",LOCATION_ISSUE:"مشكلة في الموقع",COMPETITOR:"ذهب لمنافس",NOT_INTERESTED:"غير مهتم",OTHER:"أخرى",PENDING:"قيد الانتظار"},ie={WEBSITE:"الموقع الإلكتروني",SOCIAL_MEDIA:"وسائل التواصل الاجتماعي",REFERRAL:"إحالة",COLD_CALL:"اتصال مباشر",EXHIBITION:"معرض",WALK_IN:"زيارة مباشرة",SALES:"فريق المبيعات",PARTNER:"شريك",OTHER:"أخرى"},re=[{label:"100,000 - 200,000",value:15e4},{label:"200,000 - 300,000",value:25e4},{label:"300,000 - 500,000",value:4e5},{label:"500,000 - 750,000",value:625e3},{label:"750,000 - 1,000,000",value:875e3},{label:"1,000,000 - 1,500,000",value:125e4},{label:"1,500,000 - 2,000,000",value:175e4},{label:"2,000,000 - 3,000,000",value:25e5},{label:"3,000,000 - 5,000,000",value:4e6},{label:"5,000,000 - 10,000,000",value:75e5}],sa=h=>h?new Intl.NumberFormat("ar-EG").format(h)+" جنيه":"غير محدد",Be=h=>{const x=new Date(h),N={year:"numeric",month:"long",day:"numeric"};return x.toLocaleDateString("ar-EG",N)},ke={name:"",number:"",source:"WEBSITE",address:"",state:"NEW",substate:null,budget:null,notes:"",notification_id:null},Te={salesId:null,state:null,substate:null,budget:null,source:null,isCreatedBySales:null},_a=()=>{var fe,je,be,pe,Le;const[h,x]=u.useState([]),[N,m]=u.useState([]),[_,g]=u.useState(""),[v,j]=u.useState(!1),[b,p]=u.useState(!1),[C,B]=u.useState(!1),[H,k]=u.useState(!1),[y,T]=u.useState(!1),[l,L]=u.useState(null),[c,S]=u.useState(ke),[r,A]=u.useState(Te),[O,oe]=u.useState(null),[R,W]=u.useState(!1),[q,ce]=u.useState("cards"),[G,de]=u.useState({}),{employee:n}=Xe(),{execute:Oe,isLoading:ue}=Je(),{execute:De,isLoading:we}=Ze(),{execute:Fe,isLoading:Me}=es(),{execute:He}=ss(),{execute:ye,isLoading:Q}=os(),{execute:Ge,isLoading:Y}=cs(),{execute:$e,isLoading:K}=ds(),{execute:Re,isLoading:X}=us();u.useEffect(()=>{Pe(),(n==null?void 0:n.role)==="ADMIN"?$():(n==null?void 0:n.role)==="SALES"&&(n!=null&&n.id)&&D(Number.parseInt(n.id))},[n]);const $=async()=>{try{const a=(await Oe()).map(i=>({...i,id:Number(i.id),sales_id:i.sales_id?Number(i.sales_id):null,budget:i.budget?Number(i.budget):null,is_created_by_sales:!!i.is_created_by_sales})),o=await me(a);x(o)}catch(t){I.error(t.message||"حدث خطأ أثناء تحميل بيانات العملاء")}},Pe=async()=>{try{const t=await Fe();m(t);const a={};t.forEach(o=>{a[o.id.toString()]=o.name}),de(a)}catch(t){I.error(t.message||"حدث خطأ أثناء تحميل بيانات الموظفين")}},me=async t=>{const a=t.map(i=>i.sales_id&&G[i.sales_id.toString()]?{...i,salesName:G[i.sales_id.toString()]}:i),o=a.filter(i=>i.sales_id&&!i.salesName);if(o.length>0){const i={...G};await Promise.all(o.map(async d=>{if(d.sales_id)try{const F=await He(Number(d.sales_id));d.salesName=F.name,i[d.sales_id.toString()]=F.name}catch(F){console.error(`Error fetching employee ${d.sales_id}:`,F),d.salesName=`مندوب ${d.sales_id}`}})),de(i)}return a},D=async t=>{try{const a=await De(t),o=a.map(d=>({...d,id:Number(d.id),sales_id:d.sales_id?Number(d.sales_id):null,budget:d.budget?Number(d.budget):null,is_created_by_sales:!!d.is_created_by_sales})),i=await me(o);x(i),W(!0),I.info(`تم العثور على ${a.length} عميل`)}catch(a){I.error(a.message||"حدث خطأ أثناء تحميل بيانات العملاء")}},J=u.useMemo(()=>{let t=h.filter(a=>a.name.toLowerCase().includes(_.toLowerCase()));if(r.salesId&&(t=t.filter(a=>(typeof a.sales_id=="string"?Number(a.sales_id):a.sales_id)===r.salesId)),r.state&&(t=t.filter(a=>a.state===r.state)),r.substate&&(t=t.filter(a=>a.substate===r.substate)),r.budget){const a=re.find(o=>o.value===r.budget);if(a){const[o,i]=a.label.split(" - "),d=Number.parseInt(o.replace(/,/g,"")),F=Number.parseInt(i.replace(/,/g,""));t=t.filter(Ie=>{const Se=Ie.budget?Number(Ie.budget):0;return Se>=d&&Se<=F})}}return r.source&&(t=t.filter(a=>a.source===r.source)),r.isCreatedBySales!==null&&(t=t.filter(a=>a.is_created_by_sales===r.isCreatedBySales)),t.sort((a,o)=>{const i=new Date(a.created_at).getTime();return new Date(o.created_at).getTime()-i})},[h,_,r]),E=t=>{const{name:a,value:o}=t.target;S(a==="state"?i=>{var d;return{...i,[a]:o,substate:((d=M[o])==null?void 0:d.length)>0?M[o][0]:null}}:a==="budget"?i=>({...i,[a]:o?Number.parseInt(o):null}):i=>({...i,[a]:o}))},w=t=>{const{name:a,value:o}=t.target;A(a==="state"?i=>({...i,[a]:o||null,substate:null}):a==="budget"?i=>({...i,[a]:o?Number.parseInt(o):null}):a==="salesId"?i=>({...i,[a]:o?Number.parseInt(o):null}):a==="isCreatedBySales"?i=>({...i,[a]:o===""?null:o==="true"}):i=>({...i,[a]:o||null}))},Ue=t=>{g(t.target.value)},_e=()=>{L(null),S(ke),j(!0)},Z=t=>{L(t),S({id:t.id.toString(),name:t.name,number:t.number,source:t.source,address:t.address,state:t.state,substate:t.substate,budget:t.budget,notes:t.notes,notification_id:t.notification_id}),j(!0)},he=t=>{L(t),B(!0)},xe=t=>{L(t),p(!0)},Ve=()=>{k(!0)},Ne=t=>{L(t),oe(null),T(!0)},f=()=>{j(!1),p(!1),B(!1),k(!1),T(!1)},ee=()=>{A(Te),W(!1),(n==null?void 0:n.role)==="ADMIN"?$():(n==null?void 0:n.role)==="SALES"&&(n!=null&&n.id)&&D(Number.parseInt(n.id))},ze=()=>{r.salesId&&!r.state&&!r.substate&&!r.budget&&!r.source&&r.isCreatedBySales===null?D(r.salesId):W(Object.values(r).some(t=>t!==null)),f()},We=async t=>{t.preventDefault();try{if(l)await Ge(Number(l.id),c.name,c.number,c.source,c.address,c.state,c.substate||void 0,l.sales_id,c.budget,c.notes,l.is_created_by_sales,c.notification_id),I.success("تم تحديث بيانات العميل بنجاح");else{const a=(n==null?void 0:n.role.toUpperCase())==="SALES";await ye(c.name,c.number,c.source,c.address,c.state,c.substate||"",c.budget,c.notes,a,c.notification_id),I.success("تم إضافة العميل بنجاح")}f(),(n==null?void 0:n.role)==="ADMIN"?$():(n==null?void 0:n.role)==="SALES"&&(n!=null&&n.id)&&D(Number.parseInt(n.id))}catch(a){I.error(a.message||"حدث خطأ أثناء حفظ بيانات العميل")}},qe=async()=>{if(l)try{await $e(Number(l.id)),I.success("تم حذف العميل بنجاح"),f(),(n==null?void 0:n.role)==="ADMIN"?$():(n==null?void 0:n.role)==="SALES"&&(n!=null&&n.id)&&D(Number.parseInt(n.id))}catch(t){I.error(t.message||"حدث خطأ أثناء حذف العميل")}},Qe=async()=>{if(!(!l||!O))try{await Re(Number(l.id),O),I.success("تم نقل العميل بنجاح"),f(),(n==null?void 0:n.role)==="ADMIN"?$():(n==null?void 0:n.role)==="SALES"&&(n!=null&&n.id)&&D(Number.parseInt(n.id))}catch(t){I.error(t.message||"حدث خطأ أثناء نقل العميل")}},se=t=>t.sales_id?t.salesName?t.salesName:G[t.sales_id.toString()]?G[t.sales_id.toString()]:`مندوب ${t.sales_id}`:"غير معين",Ye=t=>{const a=t.toUpperCase();return a==="NEW"?`${s.leadCard} ${s.newLead}`:a==="CONTACTED"||a==="FOLLOW_UP"?`${s.leadCard} ${s.contactedLead}`:a==="INTERESTED"||a==="VISITING"||a==="MEETING"?`${s.leadCard} ${s.interestedLead}`:a==="NEGOTIATING"||a==="QUALIFIED"?`${s.leadCard} ${s.qualifiedLead}`:a==="CLOSED_WON"?`${s.leadCard} ${s.wonLead}`:a==="CLOSED_LOST"?`${s.leadCard} ${s.lostLead}`:s.leadCard},Ke=t=>{const a=t.toUpperCase();return a==="NEW"?`${s.leadListItem} ${s.newLead}`:a==="CONTACTED"||a==="FOLLOW_UP"?`${s.leadListItem} ${s.contactedLead}`:a==="INTERESTED"||a==="VISITING"||a==="MEETING"?`${s.leadListItem} ${s.interestedLead}`:a==="NEGOTIATING"||a==="QUALIFIED"?`${s.leadListItem} ${s.qualifiedLead}`:a==="CLOSED_WON"?`${s.leadListItem} ${s.wonLead}`:a==="CLOSED_LOST"?`${s.leadListItem} ${s.lostLead}`:s.leadListItem};return e.jsxs("div",{className:s.leadsPage,children:[e.jsxs("div",{className:s.header,children:[e.jsx("h1",{className:s.title,children:"إدارة العملاء"}),e.jsxs("div",{className:s.headerActions,children:[e.jsxs("div",{className:s.searchContainer,children:[e.jsx(ts,{size:18,className:s.searchIcon}),e.jsx("input",{type:"text",placeholder:"بحث بالاسم...",value:_,onChange:Ue,className:s.searchInput})]}),e.jsxs("div",{className:s.viewToggle,children:[e.jsx("button",{className:`${s.viewButton} ${q==="cards"?s.activeView:""}`,onClick:()=>ce("cards"),"aria-label":"عرض البطاقات",children:e.jsx(as,{size:18})}),e.jsx("button",{className:`${s.viewButton} ${q==="list"?s.activeView:""}`,onClick:()=>ce("list"),"aria-label":"عرض القائمة",children:e.jsx(ns,{size:18})})]}),e.jsxs("button",{className:s.filterButton,onClick:Ve,children:[e.jsx(ls,{size:18}),e.jsx("span",{children:"تصفية"}),R&&e.jsx("span",{className:s.filterBadge})]}),e.jsxs("button",{className:s.addButton,onClick:_e,disabled:ue,children:[e.jsx(Ee,{size:18}),e.jsx("span",{children:"إضافة عميل"})]})]})]}),ue||Me||we?e.jsx(P,{isVisible:!0}):J.length===0?e.jsx("div",{className:s.emptyState,children:_||R?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"لا توجد نتائج مطابقة للبحث"}),R&&e.jsx("button",{className:s.resetButton,onClick:ee,children:"إعادة ضبط التصفية"})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"لا يوجد عملاء حالياً"}),e.jsxs("button",{className:s.addButton,onClick:_e,children:[e.jsx(Ee,{size:18}),e.jsx("span",{children:"إضافة عميل"})]})]})}):e.jsxs(e.Fragment,{children:[R&&e.jsxs("div",{className:s.filterIndicator,children:[e.jsx("span",{children:"تم تطبيق التصفية"}),e.jsx("button",{className:s.resetButton,onClick:ee,children:"إعادة ضبط"})]}),q==="cards"?e.jsx("div",{className:s.leadsGrid,children:J.map(t=>e.jsxs("div",{className:Ye(t.state),children:[e.jsxs("div",{className:`${s.leadHeader} ${s[t.state.toLowerCase()+"Header"]}`,children:[e.jsx("h3",{className:s.leadName,children:t.name}),e.jsxs("div",{className:s.actions,children:[e.jsx("button",{className:s.infoButton,onClick:()=>he(t),"aria-label":"معلومات",children:e.jsx(U,{size:18})}),(n==null?void 0:n.role)=="ADMIN"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:s.editButton,onClick:()=>Z(t),"aria-label":"تعديل",children:e.jsx(ge,{size:18})}),e.jsx("button",{className:s.deleteButton,onClick:()=>xe(t),"aria-label":"حذف",children:e.jsx(ve,{size:18})})]})]})]}),e.jsxs("div",{className:s.leadDetails,children:[e.jsxs("div",{className:s.detailItem,children:[e.jsx("span",{className:s.detailLabel,children:"رقم الهاتف:"}),e.jsxs("div",{className:s.phoneActions,children:[e.jsx("span",{className:s.detailValue,children:t.number}),e.jsxs("div",{className:s.phoneButtons,children:[e.jsx("a",{href:`tel:${t.number}`,className:s.callButton,"aria-label":"اتصال",children:e.jsx(ne,{size:16})}),e.jsx("a",{href:`https://wa.me/${t.number.replace(/\+/g,"").replace(/\s/g,"")}`,target:"_blank",rel:"noopener noreferrer",className:s.whatsappButton,"aria-label":"واتساب",children:e.jsx(ae,{size:16})})]})]})]}),(n==null?void 0:n.role)=="ADMIN"&&e.jsx(e.Fragment,{children:t.sales_id&&e.jsxs("div",{className:s.detailItem,children:[e.jsx("span",{className:s.detailLabel,children:"المندوب:"}),e.jsx("span",{className:s.detailValue,children:se(t)})]})}),e.jsxs("div",{className:s.actionButtons,children:[(n==null?void 0:n.role)=="ADMIN"&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:s.transferButton,onClick:()=>Ne(t),children:[e.jsx(Ce,{size:16}),e.jsx("span",{children:"تحويل"})]})}),e.jsxs("a",{href:`/leads/${t.id}`,className:s.detailsButton,children:[e.jsx(U,{size:16}),e.jsx("span",{children:"بيانات مفصلة"})]})]})]})]},t.id))}):e.jsx("div",{className:s.leadsList,children:J.map(t=>e.jsxs("div",{className:Ke(t.state),children:[e.jsxs("div",{className:s.leadListHeader,children:[e.jsx("h3",{className:s.leadName,children:t.name}),e.jsxs("div",{className:s.actions,children:[e.jsx("button",{className:s.infoButton,onClick:()=>he(t),"aria-label":"معلومات",children:e.jsx(U,{size:18})}),(n==null?void 0:n.role)=="ADMIN"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:s.editButton,onClick:()=>Z(t),"aria-label":"تعديل",children:e.jsx(ge,{size:18})}),e.jsx("button",{className:s.deleteButton,onClick:()=>xe(t),"aria-label":"حذف",children:e.jsx(ve,{size:18})})]})]})]}),e.jsxs("div",{className:s.leadListContent,children:[e.jsxs("div",{className:s.leadListDetails,children:[e.jsxs("div",{className:s.detailItem,children:[e.jsx("span",{className:s.detailLabel,children:"رقم الهاتف:"}),e.jsxs("div",{className:s.phoneActions,children:[e.jsx("span",{className:s.detailValue,children:t.number}),e.jsxs("div",{className:s.phoneButtons,children:[e.jsx("a",{href:`tel:${t.number}`,className:s.callButton,"aria-label":"اتصال",children:e.jsx(ne,{size:16})}),e.jsx("a",{href:`https://wa.me/${t.number.replace(/\+/g,"").replace(/\s/g,"")}`,target:"_blank",rel:"noopener noreferrer",className:s.whatsappButton,"aria-label":"واتساب",children:e.jsx(ae,{size:16})})]})]})]}),e.jsxs("div",{className:s.detailItem,children:[e.jsx("span",{className:s.detailLabel,children:"الحالة:"}),e.jsx("span",{className:`${s.detailValue} ${s[t.state.toLowerCase()+"State"]}`,children:V[t.state]||t.state})]}),(n==null?void 0:n.role)=="ADMIN"&&e.jsx(e.Fragment,{children:t.sales_id&&e.jsxs("div",{className:s.detailItem,children:[e.jsx("span",{className:s.detailLabel,children:"المندوب:"}),e.jsx("span",{className:s.detailValue,children:se(t)})]})})]}),e.jsxs("div",{className:s.leadListActions,children:[(n==null?void 0:n.role)=="ADMIN"&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:s.transferButton,onClick:()=>Ne(t),children:[e.jsx(Ce,{size:16}),e.jsx("span",{children:"تحويل"})]})}),e.jsxs("a",{href:`/leads/${t.id}`,className:s.detailsButton,children:[e.jsx(U,{size:16}),e.jsx("span",{children:"بيانات مفصلة"})]})]})]})]},t.id))})]}),v&&e.jsx("div",{className:s.modalOverlay,children:e.jsxs("div",{className:s.modal,children:[e.jsxs("div",{className:s.modalHeader,children:[e.jsx("h2",{children:l?"تعديل بيانات العميل":"إضافة عميل جديد"}),e.jsx("button",{className:s.closeButton,onClick:f,children:e.jsx(te,{size:20})})]}),e.jsxs("form",{onSubmit:We,className:s.form,children:[e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{htmlFor:"name",children:"الاسم"}),e.jsx("input",{type:"text",id:"name",name:"name",value:c.name,onChange:E,required:!0,placeholder:"أدخل اسم العميل"})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{htmlFor:"number",children:"رقم الهاتف"}),e.jsx("input",{type:"number",id:"number",name:"number",value:c.number,onChange:E,required:!0,placeholder:"أدخل رقم الهاتف"})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{htmlFor:"source",children:"المصدر"}),e.jsx("select",{id:"source",name:"source",value:c.source,onChange:E,required:!0,children:Object.entries(ie).map(([t,a])=>e.jsx("option",{value:t,children:a},t))})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{htmlFor:"address",children:"العنوان"}),e.jsx("input",{type:"text",id:"address",name:"address",value:c.address,onChange:E,required:!0,placeholder:"أدخل العنوان"})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{htmlFor:"state",children:"الحالة"}),e.jsx("select",{id:"state",name:"state",value:c.state,onChange:E,required:!0,children:Object.entries(V).map(([t,a])=>e.jsx("option",{value:t,children:a},t))})]}),((fe=M[c.state])==null?void 0:fe.length)>0&&e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{htmlFor:"substate",children:"الحالة الفرعية"}),e.jsx("select",{id:"substate",name:"substate",value:c.substate||"",onChange:E,children:M[c.state].map(t=>e.jsx("option",{value:t,children:le[t]},t))})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{htmlFor:"budget",children:"الميزانية"}),e.jsxs("select",{id:"budget",name:"budget",value:((je=c.budget)==null?void 0:je.toString())||"",onChange:E,children:[e.jsx("option",{value:"",children:"غير محدد"}),re.map(t=>e.jsx("option",{value:t.value.toString(),children:t.label},t.value))]})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{htmlFor:"notes",children:"ملاحظات"}),e.jsx("textarea",{id:"notes",name:"notes",value:c.notes||"",onChange:E,placeholder:"أدخل ملاحظات (اختياري)",rows:3})]}),e.jsxs("div",{className:s.formActions,children:[e.jsx("button",{type:"button",className:s.cancelButton,onClick:f,disabled:Q||Y,children:"إلغاء"}),e.jsx("button",{type:"submit",className:s.submitButton,disabled:Q||Y,children:Q||Y?e.jsxs(e.Fragment,{children:[e.jsx(P,{isVisible:!0}),e.jsx("span",{children:"جاري الحفظ..."})]}):e.jsx("span",{children:l?"تحديث":"إضافة"})})]})]})]})}),C&&l&&e.jsx("div",{className:s.modalOverlay,children:e.jsxs("div",{className:s.infoModal,children:[e.jsxs("div",{className:`${s.modalHeader} ${s[l.state.toLowerCase()+"Header"]}`,children:[e.jsx("h2",{children:"معلومات العميل"}),e.jsx("button",{className:s.closeButton,onClick:f,children:e.jsx(te,{size:20})})]}),e.jsxs("div",{className:s.infoContent,children:[e.jsxs("div",{className:s.infoSection,children:[e.jsx("h3",{className:s.sectionTitle,children:"المعلومات الأساسية"}),e.jsxs("div",{className:s.infoItem,children:[e.jsx("span",{className:s.infoLabel,children:"الرقم التعريفي:"}),e.jsx("span",{className:s.infoValue,children:l.id})]}),e.jsxs("div",{className:s.infoItem,children:[e.jsx("span",{className:s.infoLabel,children:"الاسم:"}),e.jsx("span",{className:s.infoValue,children:l.name})]}),e.jsxs("div",{className:s.infoItem,children:[e.jsx("span",{className:s.infoLabel,children:"رقم الهاتف:"}),e.jsxs("div",{className:s.phoneActions,children:[e.jsx("span",{className:s.infoValue,children:l.number}),e.jsxs("div",{className:s.phoneButtons,children:[e.jsx("a",{href:`tel:${l.number}`,className:s.callButton,"aria-label":"اتصال",children:e.jsx(ne,{size:16})}),e.jsx("a",{href:`https://wa.me/${l.number.replace(/\+/g,"").replace(/\s/g,"")}`,target:"_blank",rel:"noopener noreferrer",className:s.whatsappButton,"aria-label":"واتساب",children:e.jsx(ae,{size:16})})]})]})]}),e.jsxs("div",{className:s.infoItem,children:[e.jsx("span",{className:s.infoLabel,children:"العنوان:"}),e.jsx("span",{className:s.infoValue,children:l.address})]})]}),e.jsxs("div",{className:s.infoSection,children:[e.jsx("h3",{className:s.sectionTitle,children:"حالة العميل"}),e.jsxs("div",{className:s.infoItem,children:[e.jsx("span",{className:s.infoLabel,children:"الحالة:"}),e.jsx("span",{className:`${s.infoValue} ${s[l.state.toLowerCase()+"State"]}`,children:V[l.state]||l.state})]}),l.substate&&e.jsxs("div",{className:s.infoItem,children:[e.jsx("span",{className:s.infoLabel,children:"الحالة الفرعية:"}),e.jsx("span",{className:s.infoValue,children:le[l.substate]||l.substate})]}),e.jsxs("div",{className:s.infoItem,children:[e.jsx("span",{className:s.infoLabel,children:"المصدر:"}),e.jsx("span",{className:s.infoValue,children:ie[l.source]||l.source})]}),e.jsxs("div",{className:s.infoItem,children:[e.jsx("span",{className:s.infoLabel,children:"الميزانية:"}),e.jsx("span",{className:s.infoValue,children:sa(l.budget)})]})]}),e.jsxs("div",{className:s.infoSection,children:[e.jsx("h3",{className:s.sectionTitle,children:"معلومات إضافية"}),e.jsxs("div",{className:s.infoItem,children:[e.jsx("span",{className:s.infoLabel,children:"مسؤول المبيعات:"}),e.jsx("span",{className:s.infoValue,children:se(l)})]}),e.jsxs("div",{className:s.infoItem,children:[e.jsx("span",{className:s.infoLabel,children:"تم إنشاؤه بواسطة:"}),e.jsx("span",{className:s.infoValue,children:l.is_created_by_sales?"فريق المبيعات":"النظام"})]}),e.jsxs("div",{className:s.infoItem,children:[e.jsx("span",{className:s.infoLabel,children:"تاريخ الإنشاء:"}),e.jsx("span",{className:s.infoValue,children:Be(l.created_at.toString())})]}),e.jsxs("div",{className:s.infoItem,children:[e.jsx("span",{className:s.infoLabel,children:"آخر تحديث:"}),e.jsx("span",{className:s.infoValue,children:Be(l.updated_at.toString())})]})]}),l.notes&&e.jsxs("div",{className:s.infoSection,children:[e.jsx("h3",{className:s.sectionTitle,children:"ملاحظات"}),e.jsx("div",{className:s.notesBox,children:l.notes})]})]}),e.jsxs("div",{className:s.infoActions,children:[e.jsx("button",{className:s.closeInfoButton,onClick:f,children:"إغلاق"}),(n==null?void 0:n.role)=="ADMIN"&&e.jsx(e.Fragment,{children:e.jsx("button",{className:s.editInfoButton,onClick:()=>{f(),Z(l)},children:"تعديل"})})]})]})}),H&&e.jsx("div",{className:s.modalOverlay,children:e.jsxs("div",{className:s.modal,children:[e.jsxs("div",{className:s.modalHeader,children:[e.jsx("h2",{children:"تصفية العملاء"}),e.jsx("button",{className:s.closeButton,onClick:f,children:e.jsx(te,{size:20})})]}),e.jsxs("div",{className:s.filterForm,children:[e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{htmlFor:"salesId",children:"مسؤول المبيعات"}),e.jsxs("select",{id:"salesId",name:"salesId",value:((be=r.salesId)==null?void 0:be.toString())||"",onChange:w,children:[e.jsx("option",{value:"",children:"الكل"}),N.filter(t=>t.role.toUpperCase()==="SALES"||t.role.toUpperCase()==="ADMIN").map(t=>e.jsx("option",{value:t.id.toString(),children:t.name},t.id))]})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{htmlFor:"state",children:"الحالة"}),e.jsxs("select",{id:"state",name:"state",value:r.state||"",onChange:w,children:[e.jsx("option",{value:"",children:"الكل"}),Object.entries(V).map(([t,a])=>e.jsx("option",{value:t,children:a},t))]})]}),r.state&&((pe=M[r.state])==null?void 0:pe.length)>0&&e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{htmlFor:"substate",children:"الحالة الفرعية"}),e.jsxs("select",{id:"substate",name:"substate",value:r.substate||"",onChange:w,children:[e.jsx("option",{value:"",children:"الكل"}),M[r.state].map(t=>e.jsx("option",{value:t,children:le[t]},t))]})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{htmlFor:"source",children:"المصدر"}),e.jsxs("select",{id:"source",name:"source",value:r.source||"",onChange:w,children:[e.jsx("option",{value:"",children:"الكل"}),Object.entries(ie).map(([t,a])=>e.jsx("option",{value:t,children:a},t))]})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{htmlFor:"budget",children:"الميزانية"}),e.jsxs("select",{id:"budget",name:"budget",value:((Le=r.budget)==null?void 0:Le.toString())||"",onChange:w,children:[e.jsx("option",{value:"",children:"الكل"}),re.map(t=>e.jsx("option",{value:t.value.toString(),children:t.label},t.value))]})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{htmlFor:"isCreatedBySales",children:"تم إنشاؤه بواسطة"}),e.jsxs("select",{id:"isCreatedBySales",name:"isCreatedBySales",value:r.isCreatedBySales===null?"":r.isCreatedBySales.toString(),onChange:w,children:[e.jsx("option",{value:"",children:"الكل"}),e.jsx("option",{value:"true",children:"فريق المبيعات"}),e.jsx("option",{value:"false",children:"النظام"})]})]}),e.jsxs("div",{className:s.filterActions,children:[e.jsx("button",{type:"button",className:s.resetFilterButton,onClick:ee,children:"إعادة ضبط"}),e.jsx("button",{type:"button",className:s.applyFilterButton,onClick:ze,children:"تطبيق"})]})]})]})}),y&&l&&e.jsx("div",{className:s.modalOverlay,children:e.jsxs("div",{className:s.transferModal,children:[e.jsx("h2",{children:"تحويل العميل"}),e.jsxs("p",{children:['اختر مسؤول المبيعات الذي تريد تحويل العميل "',l.name,'" إليه.']}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{htmlFor:"transferSalesId",children:"مسؤول المبيعات"}),e.jsxs("select",{id:"transferSalesId",value:(O==null?void 0:O.toString())||"",onChange:t=>oe(t.target.value?Number.parseInt(t.target.value):null),required:!0,children:[e.jsx("option",{value:"",children:"اختر مسؤول المبيعات"}),N.filter(t=>t.role.toUpperCase()==="SALES"&&t.id!==l.sales_id).map(t=>e.jsx("option",{value:t.id.toString(),children:t.name},t.id))]})]}),e.jsxs("div",{className:s.transferActions,children:[e.jsx("button",{className:s.cancelButton,onClick:f,disabled:X,children:"إلغاء"}),e.jsx("button",{className:s.transferConfirmButton,onClick:Qe,disabled:X||!O,children:X?e.jsxs(e.Fragment,{children:[e.jsx(P,{isVisible:!0}),e.jsx("span",{children:"جاري التحويل..."})]}):e.jsx("span",{children:"تأكيد التحويل"})})]})]})}),b&&l&&e.jsx("div",{className:s.modalOverlay,children:e.jsxs("div",{className:s.confirmModal,children:[e.jsx("h2",{children:"تأكيد الحذف"}),e.jsxs("p",{children:['هل أنت متأكد من رغبتك في حذف العميل "',l.name,'"؟',e.jsx("br",{}),"هذا الإجراء لا يمكن التراجع عنه."]}),e.jsxs("div",{className:s.confirmActions,children:[e.jsx("button",{className:s.cancelButton,onClick:f,disabled:K,children:"إلغاء"}),e.jsx("button",{className:s.deleteConfirmButton,onClick:qe,disabled:K,children:K?e.jsxs(e.Fragment,{children:[e.jsx(P,{isVisible:!0}),e.jsx("span",{children:"جاري الحذف..."})]}):e.jsx("span",{children:"تأكيد الحذف"})})]})]})})]})};export{_a as default};
