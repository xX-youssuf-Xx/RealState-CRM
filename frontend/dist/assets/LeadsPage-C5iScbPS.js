import{c as V,r as m,d as ss,u as ts,y as L,j as e,L as R}from"./index-Dw9eA6zH.js";import{P as Be}from"./ReactToastify-CzGeHtdl.js";import{a as as,u as ns}from"./useGetAllLeads-ByizNWcV.js";import{u as ls}from"./useGetLeadBySalesId-EJfMrTMP.js";import{u as is}from"./useGetEmployee-BIOmhnQr.js";import{S as rs,G as os,L as cs}from"./search-DIF0ChIb.js";import{F as ds}from"./funnel-D-MF_BdE.js";import{I as P}from"./info-DOPSyMXK.js";import{S as ke,T as Te}from"./trash-2-CJ1Ns07C.js";import{c as Fe,X as ne}from"./x-m5D02e-r.js";import{E as le}from"./external-link-D6Cvo8sx.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const us=[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]],ie=Fe("phone",us);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ms=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],Ae=Fe("user-plus",ms),_s=()=>{const{isLoading:h,error:_,data:x,setError:d,_execute:N}=V(),I=m.useCallback(async(j,S,b,f,F,M,z,H,W,G,q,y={})=>{try{return await N("leads","POST",{name:j,number:S,source:b,address:f,state:F,substate:M,budget:z,notes:H,is_created_by_sales:W,notification_id:G,campaign:q},y)}catch(l){throw d(l),l}},[N,d]);return{isLoading:h,error:_,data:x,execute:I,setError:d}},hs=()=>{const{isLoading:h,error:_,data:x,setError:d,_execute:N}=V(),I=m.useCallback(async(j,S,b={})=>{try{return await N(`leads/${j}`,"PATCH",S,b)}catch(f){throw d(f),f}},[N,d]);return{isLoading:h,error:_,data:x,execute:I,setError:d}},xs=(h,_)=>{const x={};return Object.keys(_).forEach(d=>{_[d]!==void 0&&_[d]!==h[d]&&(x[d]=_[d])}),x},Ns=()=>{const{isLoading:h,error:_,data:x,setError:d,_execute:N}=V(),I=m.useCallback(async(j,S={})=>{try{return await N(`leads/${j}`,"DELETE",null,S)}catch(b){throw d(b),b}},[N,d]);return{isLoading:h,error:_,data:x,execute:I,setError:d}},fs=()=>{const{isLoading:h,error:_,data:x,setError:d,_execute:N}=V(),I=m.useCallback(async(j,S,b={})=>{try{const f={new_sales_id:S};return await N(`leads/${j}/transfer`,"PATCH",f,b)}catch(f){throw d(f),f}},[N,d]);return{isLoading:h,error:_,data:x,execute:I,setError:d}},js="_leadsPage_5ke74_1",ps="_header_5ke74_11",bs="_title_5ke74_25",Ls="_headerActions_5ke74_37",Is="_searchContainer_5ke74_49",Ss="_searchIcon_5ke74_59",gs="_searchInput_5ke74_75",vs="_filterButton_5ke74_103",Es="_filterBadge_5ke74_141",Cs="_addButton_5ke74_161",Bs="_filterIndicator_5ke74_207",ks="_resetButton_5ke74_227",Ts="_emptyState_5ke74_257",As="_leadsGrid_5ke74_283",Os="_leadCard_5ke74_297",Ds="_newLead_5ke74_325",ws="_contactedLead_5ke74_333",Fs="_interestedLead_5ke74_341",Ms="_qualifiedLead_5ke74_349",Hs="_wonLead_5ke74_357",Gs="_lostLead_5ke74_365",ys="_leadHeader_5ke74_375",$s="_newHeader_5ke74_393",Rs="_contactedHeader_5ke74_401",Ps="_follow_upHeader_5ke74_403",Us="_interestedHeader_5ke74_411",Vs="_visitingHeader_5ke74_413",zs="_meetingHeader_5ke74_415",Ws="_negotiatingHeader_5ke74_425",qs="_qualifiedHeader_5ke74_427",Qs="_closed_wonHeader_5ke74_435",Ys="_closed_lostHeader_5ke74_443",Ks="_leadName_5ke74_451",Xs="_actions_5ke74_463",Js="_editButton_5ke74_473",Zs="_deleteButton_5ke74_475",et="_infoButton_5ke74_477",st="_leadDetails_5ke74_545",tt="_detailItem_5ke74_553",at="_detailLabel_5ke74_575",nt="_detailValue_5ke74_585",lt="_phoneActions_5ke74_593",it="_phoneButtons_5ke74_605",rt="_callButton_5ke74_615",ot="_whatsappButton_5ke74_617",ct="_actionButtons_5ke74_673",dt="_transferButton_5ke74_685",ut="_detailsButton_5ke74_687",mt="_newState_5ke74_795",_t="_contactedState_5ke74_805",ht="_follow_upState_5ke74_807",xt="_interestedState_5ke74_817",Nt="_visitingState_5ke74_819",ft="_meetingState_5ke74_821",jt="_negotiatingState_5ke74_831",pt="_qualifiedState_5ke74_833",bt="_closed_wonState_5ke74_843",Lt="_closed_lostState_5ke74_853",It="_modalOverlay_5ke74_865",St="_modal_5ke74_865",gt="_modalHeader_5ke74_927",vt="_closeButton_5ke74_961",Et="_form_5ke74_1013",Ct="_filterForm_5ke74_1015",Bt="_formGroup_5ke74_1023",kt="_formActions_5ke74_1083",Tt="_filterActions_5ke74_1085",At="_transferActions_5ke74_1087",Ot="_cancelButton_5ke74_1101",Dt="_submitButton_5ke74_1143",wt="_applyFilterButton_5ke74_1145",Ft="_transferConfirmButton_5ke74_1147",Mt="_resetFilterButton_5ke74_1205",Ht="_infoModal_5ke74_1237",Gt="_infoContent_5ke74_1267",yt="_infoSection_5ke74_1289",$t="_sectionTitle_5ke74_1305",Rt="_infoItem_5ke74_1321",Pt="_infoLabel_5ke74_1341",Ut="_infoValue_5ke74_1353",Vt="_notesBox_5ke74_1361",zt="_infoActions_5ke74_1377",Wt="_closeInfoButton_5ke74_1391",qt="_editInfoButton_5ke74_1393",Qt="_transferModal_5ke74_1429",Yt="_confirmModal_5ke74_1473",Kt="_confirmActions_5ke74_1517",Xt="_deleteConfirmButton_5ke74_1529",Jt="_viewToggle_5ke74_1663",Zt="_viewButton_5ke74_1675",ea="_activeView_5ke74_1709",sa="_leadsList_5ke74_1731",ta="_leadListItem_5ke74_1743",aa="_leadListHeader_5ke74_1771",na="_leadListContent_5ke74_1785",la="_leadListDetails_5ke74_1797",ia="_leadListActions_5ke74_1807",s={leadsPage:js,header:ps,title:bs,headerActions:Ls,searchContainer:Is,searchIcon:Ss,searchInput:gs,filterButton:vs,filterBadge:Es,addButton:Cs,filterIndicator:Bs,resetButton:ks,emptyState:Ts,leadsGrid:As,leadCard:Os,newLead:Ds,contactedLead:ws,interestedLead:Fs,qualifiedLead:Ms,wonLead:Hs,lostLead:Gs,leadHeader:ys,newHeader:$s,contactedHeader:Rs,follow_upHeader:Ps,interestedHeader:Us,visitingHeader:Vs,meetingHeader:zs,negotiatingHeader:Ws,qualifiedHeader:qs,closed_wonHeader:Qs,closed_lostHeader:Ys,leadName:Ks,actions:Xs,editButton:Js,deleteButton:Zs,infoButton:et,leadDetails:st,detailItem:tt,detailLabel:at,detailValue:nt,phoneActions:lt,phoneButtons:it,callButton:rt,whatsappButton:ot,actionButtons:ct,transferButton:dt,detailsButton:ut,newState:mt,contactedState:_t,follow_upState:ht,interestedState:xt,visitingState:Nt,meetingState:ft,negotiatingState:jt,qualifiedState:pt,closed_wonState:bt,closed_lostState:Lt,modalOverlay:It,modal:St,modalHeader:gt,closeButton:vt,form:Et,filterForm:Ct,formGroup:Bt,formActions:kt,filterActions:Tt,transferActions:At,cancelButton:Ot,submitButton:Dt,applyFilterButton:wt,transferConfirmButton:Ft,resetFilterButton:Mt,infoModal:Ht,infoContent:Gt,infoSection:yt,sectionTitle:$t,infoItem:Rt,infoLabel:Pt,infoValue:Ut,notesBox:Vt,infoActions:zt,closeInfoButton:Wt,editInfoButton:qt,transferModal:Qt,confirmModal:Yt,confirmActions:Kt,deleteConfirmButton:Xt,viewToggle:Jt,viewButton:Zt,activeView:ea,leadsList:sa,leadListItem:ta,leadListHeader:aa,leadListContent:na,leadListDetails:la,leadListActions:ia},U={NEW:"جديد",CONTACTED:"تم التواصل",INTERESTED:"مهتم",VISITING:"زيارة",MEETING:"اجتماع",NEGOTIATING:"تفاوض",QUALIFIED:"مؤهل",CLOSED_WON:"تم الإغلاق (نجاح)",CLOSED_LOST:"تم الإغلاق (خسارة)",FOLLOW_UP:"متابعة"},A={NEW:[],CONTACTED:["CALLBACK_REQUESTED","NO_ANSWER","WRONG_NUMBER"],INTERESTED:["HIGH_INTEREST","MEDIUM_INTEREST","LOW_INTEREST"],VISITING:["SCHEDULED","COMPLETED","CANCELLED"],MEETING:["SCHEDULED","COMPLETED","CANCELLED"],NEGOTIATING:["PRICE_DISCUSSION","PAYMENT_PLAN","FINAL_OFFER"],QUALIFIED:["READY_TO_BUY","NEEDS_FINANCING","CONSIDERING_OPTIONS"],CLOSED_WON:["FULL_PAYMENT","INSTALLMENT_PLAN"],CLOSED_LOST:["PRICE_ISSUE","LOCATION_ISSUE","COMPETITOR","NOT_INTERESTED","OTHER"],FOLLOW_UP:["SCHEDULED","PENDING"]},re={CALLBACK_REQUESTED:"طلب معاودة الاتصال",NO_ANSWER:"لا يوجد رد",WRONG_NUMBER:"رقم خاطئ",HIGH_INTEREST:"اهتمام عالي",MEDIUM_INTEREST:"اهتمام متوسط",LOW_INTEREST:"اهتمام منخفض",SCHEDULED:"مجدول",COMPLETED:"مكتمل",CANCELLED:"ملغي",PRICE_DISCUSSION:"مناقشة السعر",PAYMENT_PLAN:"خطة الدفع",FINAL_OFFER:"العرض النهائي",READY_TO_BUY:"جاهز للشراء",NEEDS_FINANCING:"يحتاج تمويل",CONSIDERING_OPTIONS:"يدرس الخيارات",FULL_PAYMENT:"دفع كامل",INSTALLMENT_PLAN:"خطة أقساط",PRICE_ISSUE:"مشكلة في السعر",LOCATION_ISSUE:"مشكلة في الموقع",COMPETITOR:"ذهب لمنافس",NOT_INTERESTED:"غير مهتم",OTHER:"أخرى",PENDING:"قيد الانتظار"},oe={WEBSITE:"الموقع الإلكتروني",SOCIAL_MEDIA:"وسائل التواصل الاجتماعي",REFERRAL:"إحالة",COLD_CALL:"اتصال مباشر",EXHIBITION:"معرض",WALK_IN:"زيارة مباشرة",SALES:"فريق المبيعات",PARTNER:"شريك",OTHER:"أخرى"},ce=[{label:"100,000 - 200,000",value:15e4},{label:"200,000 - 300,000",value:25e4},{label:"300,000 - 500,000",value:4e5},{label:"500,000 - 750,000",value:625e3},{label:"750,000 - 1,000,000",value:875e3},{label:"1,000,000 - 1,500,000",value:125e4},{label:"1,500,000 - 2,000,000",value:175e4},{label:"2,000,000 - 3,000,000",value:25e5},{label:"3,000,000 - 5,000,000",value:4e6},{label:"5,000,000 - 10,000,000",value:75e5}],ra=h=>h?new Intl.NumberFormat("ar-EG").format(h)+" جنيه":"غير محدد",Oe=h=>{const _=new Date(h),x={year:"numeric",month:"long",day:"numeric"};return _.toLocaleDateString("ar-EG",x)},De={name:"",number:"",source:"WEBSITE",address:"",state:"NEW",substate:null,budget:null,notes:"",notification_id:null},we={salesId:null,state:null,substate:null,budget:null,source:null,isCreatedBySales:null},pa=()=>{var pe,be,Le,Ie,Se,ge,ve;const[h]=ss(),_=h.get("employeeId"),[x,d]=m.useState([]),[N,I]=m.useState([]),[j,S]=m.useState(""),[b,f]=m.useState(!1),[F,M]=m.useState(!1),[z,H]=m.useState(!1),[W,G]=m.useState(!1),[q,y]=m.useState(!1),[l,E]=m.useState(null),[o,O]=m.useState(De),[c,C]=m.useState(we),[B,de]=m.useState(null),[$,Q]=m.useState(!1),[Y,ue]=m.useState("cards"),[D,me]=m.useState({}),{employee:n}=ts(),{execute:Me,isLoading:_e}=as(),{execute:He,isLoading:Ge}=ls(),{execute:ye,isLoading:$e}=ns(),{execute:Re}=is(),{execute:Pe,isLoading:K}=_s(),{execute:Ue,isLoading:X}=hs(),{execute:Ve,isLoading:J}=Ns(),{execute:ze,isLoading:Z}=fs();m.useEffect(()=>{We(),_?v(Number.parseInt(_)):(n==null?void 0:n.role)==="ADMIN"||(n==null?void 0:n.role)==="MANAGER"?w():(n==null?void 0:n.role)==="SALES"&&(n!=null&&n.id)&&v(Number.parseInt(n.id))},[n,_]);const w=async()=>{try{const a=(await Me()).map(i=>({...i,id:Number(i.id),sales_id:i.sales_id?Number(i.sales_id):null,budget:i.budget?Number(i.budget):null,is_created_by_sales:!!i.is_created_by_sales})),r=await he(a);d(r)}catch(t){L.error(t.message||"حدث خطأ أثناء تحميل بيانات العملاء")}},We=async()=>{try{const t=await ye();I(t);const a={};t.forEach(r=>{a[r.id.toString()]=r.name}),me(a)}catch(t){L.error(t.message||"حدث خطأ أثناء تحميل بيانات الموظفين")}},he=async t=>{const a=t.map(i=>i.sales_id&&D[i.sales_id.toString()]?{...i,salesName:D[i.sales_id.toString()]}:i),r=a.filter(i=>i.sales_id&&!i.salesName);if(r.length>0){const i={...D};await Promise.all(r.map(async u=>{if(u.sales_id)try{const T=await Re(Number(u.sales_id));u.salesName=T.name,i[u.sales_id.toString()]=T.name}catch(T){console.error(`Error fetching employee ${u.sales_id}:`,T),u.salesName=`مندوب ${u.sales_id}`}})),me(i)}return a},v=async t=>{try{const a=await He(t),r=a.map(u=>({...u,id:Number(u.id),sales_id:u.sales_id?Number(u.sales_id):null,budget:u.budget?Number(u.budget):null,is_created_by_sales:!!u.is_created_by_sales})),i=await he(r);d(i),Q(!0),L.info(`تم العثور على ${a.length} عميل`)}catch(a){L.error(a.message||"حدث خطأ أثناء تحميل بيانات العملاء")}},ee=m.useMemo(()=>{let t=x.filter(a=>a.name.toLowerCase().includes(j.toLowerCase()));if(c.salesId&&(t=t.filter(a=>(typeof a.sales_id=="string"?Number(a.sales_id):a.sales_id)===c.salesId)),c.state&&(t=t.filter(a=>a.state===c.state)),c.substate&&(t=t.filter(a=>a.substate===c.substate)),c.budget){const a=ce.find(r=>r.value===c.budget);if(a){const[r,i]=a.label.split(" - "),u=Number.parseInt(r.replace(/,/g,"")),T=Number.parseInt(i.replace(/,/g,""));t=t.filter(Ee=>{const Ce=Ee.budget?Number(Ee.budget):0;return Ce>=u&&Ce<=T})}}return c.source&&(t=t.filter(a=>a.source===c.source)),c.isCreatedBySales!==null&&(t=t.filter(a=>a.is_created_by_sales===c.isCreatedBySales)),t.sort((a,r)=>{const i=new Date(a.created_at).getTime();return new Date(r.created_at).getTime()-i})},[x,j,c]),g=t=>{const{name:a,value:r}=t.target;O(a==="state"?i=>{var u;return{...i,[a]:r,substate:((u=A[r])==null?void 0:u.length)>0?A[r][0]:null}}:a==="budget"?i=>({...i,[a]:r?Number.parseInt(r):null}):i=>({...i,[a]:r}))},k=t=>{const{name:a,value:r}=t.target;C(a==="state"?i=>({...i,[a]:r||null,substate:null}):a==="budget"?i=>({...i,[a]:r?Number.parseInt(r):null}):a==="salesId"?i=>({...i,[a]:r?Number.parseInt(r):null}):a==="isCreatedBySales"?i=>({...i,[a]:r===""?null:r==="true"}):i=>({...i,[a]:r||null}))},qe=t=>{S(t.target.value)},xe=()=>{E(null),O(De),f(!0)},se=t=>{E(t),O({id:t.id.toString(),name:t.name,number:t.number,source:t.source,address:t.address,state:t.state,substate:t.substate,budget:t.budget,notes:t.notes,notification_id:t.notification_id}),f(!0)},Ne=t=>{E(t),H(!0)},fe=t=>{E(t),M(!0)},Qe=()=>{G(!0)},je=t=>{E(t),de(null),y(!0)},p=()=>{f(!1),M(!1),H(!1),G(!1),y(!1)},te=()=>{C(we),Q(!1),(n==null?void 0:n.role)==="ADMIN"?w():(n==null?void 0:n.role)==="SALES"&&(n!=null&&n.id)&&v(Number.parseInt(n.id))},Ye=()=>{c.salesId&&!c.state&&!c.substate&&!c.budget&&!c.source&&c.isCreatedBySales===null?v(c.salesId):Q(Object.values(c).some(t=>t!==null)),p()},Ke=async t=>{t.preventDefault();try{if(l){const a={name:o.name,number:o.number,source:o.source,address:o.address,state:o.state,substate:o.substate||void 0,budget:o.budget,notes:o.notes,notification_id:o.notification_id,campaign:o.campaign},r=xs(l,a);await Ue(Number(l.id),r),L.success("تم تحديث بيانات العميل بنجاح")}else{const a=(n==null?void 0:n.role.toUpperCase())==="SALES";await Pe(o.name,o.number,o.source,o.address,o.state,o.substate||"",o.budget,o.notes,a,o.notification_id,o.campaign||null),L.success("تم إضافة العميل بنجاح")}p(),(n==null?void 0:n.role)==="ADMIN"?w():(n==null?void 0:n.role)==="SALES"&&(n!=null&&n.id)&&v(Number.parseInt(n.id))}catch(a){L.error(a.message||"حدث خطأ أثناء حفظ بيانات العميل")}},Xe=async()=>{if(l)try{await Ve(Number(l.id)),L.success("تم حذف العميل بنجاح"),p(),(n==null?void 0:n.role)==="ADMIN"?w():(n==null?void 0:n.role)==="SALES"&&(n!=null&&n.id)&&v(Number.parseInt(n.id))}catch(t){L.error(t.message||"حدث خطأ أثناء حذف العميل")}},Je=async()=>{if(!(!l||!B))try{await ze(Number(l.id),B),L.success("تم نقل العميل بنجاح"),p(),(n==null?void 0:n.role)==="ADMIN"?w():(n==null?void 0:n.role)==="SALES"&&(n!=null&&n.id)&&v(Number.parseInt(n.id))}catch(t){L.error(t.message||"حدث خطأ أثناء نقل العميل")}},ae=t=>t.sales_id?t.salesName?t.salesName:D[t.sales_id.toString()]?D[t.sales_id.toString()]:`مندوب ${t.sales_id}`:"غير معين",Ze=t=>{const a=t==null?void 0:t.toUpperCase();return a==="NEW"?`${s.leadCard} ${s.newLead}`:a==="CONTACTED"||a==="FOLLOW_UP"?`${s.leadCard} ${s.contactedLead}`:a==="INTERESTED"||a==="VISITING"||a==="MEETING"?`${s.leadCard} ${s.interestedLead}`:a==="NEGOTIATING"||a==="QUALIFIED"?`${s.leadCard} ${s.qualifiedLead}`:a==="CLOSED_WON"?`${s.leadCard} ${s.wonLead}`:a==="CLOSED_LOST"?`${s.leadCard} ${s.lostLead}`:s.leadCard},es=t=>{const a=t.toUpperCase();return a==="NEW"?`${s.leadListItem} ${s.newLead}`:a==="CONTACTED"||a==="FOLLOW_UP"?`${s.leadListItem} ${s.contactedLead}`:a==="INTERESTED"||a==="VISITING"||a==="MEETING"?`${s.leadListItem} ${s.interestedLead}`:a==="NEGOTIATING"||a==="QUALIFIED"?`${s.leadListItem} ${s.qualifiedLead}`:a==="CLOSED_WON"?`${s.leadListItem} ${s.wonLead}`:a==="CLOSED_LOST"?`${s.leadListItem} ${s.lostLead}`:s.leadListItem};return e.jsxs("div",{className:s.leadsPage,children:[e.jsxs("div",{className:s.header,children:[e.jsx("h1",{className:s.title,children:"إدارة العملاء"}),e.jsxs("div",{className:s.headerActions,children:[e.jsxs("div",{className:s.searchContainer,children:[e.jsx(rs,{size:18,className:s.searchIcon}),e.jsx("input",{type:"text",placeholder:"بحث بالاسم...",value:j,onChange:qe,className:s.searchInput})]}),e.jsxs("div",{className:s.viewToggle,children:[e.jsx("button",{className:`${s.viewButton} ${Y==="cards"?s.activeView:""}`,onClick:()=>ue("cards"),"aria-label":"عرض البطاقات",children:e.jsx(os,{size:18})}),e.jsx("button",{className:`${s.viewButton} ${Y==="list"?s.activeView:""}`,onClick:()=>ue("list"),"aria-label":"عرض القائمة",children:e.jsx(cs,{size:18})})]}),e.jsxs("button",{className:s.filterButton,onClick:Qe,children:[e.jsx(ds,{size:18}),e.jsx("span",{children:"تصفية"}),$&&e.jsx("span",{className:s.filterBadge})]}),e.jsxs("button",{className:s.addButton,onClick:xe,disabled:_e,children:[e.jsx(Be,{size:18}),e.jsx("span",{children:"إضافة عميل"})]})]})]}),_e||$e||Ge?e.jsx(R,{isVisible:!0}):ee.length===0?e.jsx("div",{className:s.emptyState,children:j||$?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"لا توجد نتائج مطابقة للبحث"}),$&&e.jsx("button",{className:s.resetButton,onClick:te,children:"إعادة ضبط التصفية"})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"لا يوجد عملاء حالياً"}),e.jsxs("button",{className:s.addButton,onClick:xe,children:[e.jsx(Be,{size:18}),e.jsx("span",{children:"إضافة عميل"})]})]})}):e.jsxs(e.Fragment,{children:[$&&e.jsxs("div",{className:s.filterIndicator,children:[e.jsx("span",{children:"تم تطبيق التصفية"}),e.jsx("button",{className:s.resetButton,onClick:te,children:"إعادة ضبط"})]}),Y==="cards"?e.jsx("div",{className:s.leadsGrid,children:ee.map(t=>{var a;return e.jsxs("div",{className:Ze(t.state),children:[e.jsxs("div",{className:`${s.leadHeader} ${s[((a=t.state)==null?void 0:a.toLowerCase())+"Header"]}`,children:[e.jsx("h3",{className:s.leadName,children:t.name}),e.jsxs("div",{className:s.actions,children:[e.jsx("button",{className:s.infoButton,onClick:()=>Ne(t),"aria-label":"معلومات",children:e.jsx(P,{size:18})}),(n==null?void 0:n.role)=="ADMIN"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:s.editButton,onClick:()=>se(t),"aria-label":"تعديل",children:e.jsx(ke,{size:18})}),e.jsx("button",{className:s.deleteButton,onClick:()=>fe(t),"aria-label":"حذف",children:e.jsx(Te,{size:18})})]})]})]}),e.jsxs("div",{className:s.leadDetails,children:[e.jsxs("div",{className:s.detailItem,children:[e.jsx("span",{className:s.detailLabel,children:"رقم الهاتف:"}),e.jsxs("div",{className:s.phoneActions,children:[e.jsx("span",{className:s.detailValue,children:t.number}),e.jsxs("div",{className:s.phoneButtons,children:[e.jsx("a",{href:`tel:${t.number}`,className:s.callButton,"aria-label":"اتصال",children:e.jsx(ie,{size:16})}),e.jsx("a",{href:`https://wa.me/${t.number.replace(/\+/g,"").replace(/\s/g,"")}`,target:"_blank",rel:"noopener noreferrer",className:s.whatsappButton,"aria-label":"واتساب",children:e.jsx(le,{size:16})})]})]})]}),(n==null?void 0:n.role)=="ADMIN"&&e.jsx(e.Fragment,{children:t.sales_id&&e.jsxs("div",{className:s.detailItem,children:[e.jsx("span",{className:s.detailLabel,children:"المندوب:"}),e.jsx("span",{className:s.detailValue,children:ae(t)})]})}),e.jsxs("div",{className:s.actionButtons,children:[(n==null?void 0:n.role)=="ADMIN"&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:s.transferButton,onClick:()=>je(t),children:[e.jsx(Ae,{size:16}),e.jsx("span",{children:"تحويل"})]})}),e.jsxs("a",{href:`/leads/${t.id}`,className:s.detailsButton,children:[e.jsx(P,{size:16}),e.jsx("span",{children:"بيانات مفصلة"})]})]})]})]},t.id)})}):e.jsx("div",{className:s.leadsList,children:ee.map(t=>{var a;return e.jsxs("div",{className:es(t.state),children:[e.jsxs("div",{className:s.leadListHeader,children:[e.jsx("h3",{className:s.leadName,children:t.name}),e.jsxs("div",{className:s.actions,children:[e.jsx("button",{className:s.infoButton,onClick:()=>Ne(t),"aria-label":"معلومات",children:e.jsx(P,{size:18})}),(n==null?void 0:n.role)=="ADMIN"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:s.editButton,onClick:()=>se(t),"aria-label":"تعديل",children:e.jsx(ke,{size:18})}),e.jsx("button",{className:s.deleteButton,onClick:()=>fe(t),"aria-label":"حذف",children:e.jsx(Te,{size:18})})]})]})]}),e.jsxs("div",{className:s.leadListContent,children:[e.jsxs("div",{className:s.leadListDetails,children:[e.jsxs("div",{className:s.detailItem,children:[e.jsx("span",{className:s.detailLabel,children:"رقم الهاتف:"}),e.jsxs("div",{className:s.phoneActions,children:[e.jsx("span",{className:s.detailValue,children:t.number}),e.jsxs("div",{className:s.phoneButtons,children:[e.jsx("a",{href:`tel:${t.number}`,className:s.callButton,"aria-label":"اتصال",children:e.jsx(ie,{size:16})}),e.jsx("a",{href:`https://wa.me/${t.number.replace(/\+/g,"").replace(/\s/g,"")}`,target:"_blank",rel:"noopener noreferrer",className:s.whatsappButton,"aria-label":"واتساب",children:e.jsx(le,{size:16})})]})]})]}),e.jsxs("div",{className:s.detailItem,children:[e.jsx("span",{className:s.detailLabel,children:"الحالة:"}),e.jsx("span",{className:`${s.detailValue} ${s[((a=t.state)==null?void 0:a.toLowerCase())+"State"]}`,children:U[t.state]||t.state})]}),(n==null?void 0:n.role)=="ADMIN"&&e.jsx(e.Fragment,{children:t.sales_id&&e.jsxs("div",{className:s.detailItem,children:[e.jsx("span",{className:s.detailLabel,children:"المندوب:"}),e.jsx("span",{className:s.detailValue,children:ae(t)})]})})]}),e.jsxs("div",{className:s.leadListActions,children:[(n==null?void 0:n.role)=="ADMIN"&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:s.transferButton,onClick:()=>je(t),children:[e.jsx(Ae,{size:16}),e.jsx("span",{children:"تحويل"})]})}),e.jsxs("a",{href:`/leads/${t.id}`,className:s.detailsButton,children:[e.jsx(P,{size:16}),e.jsx("span",{children:"بيانات مفصلة"})]})]})]})]},t.id)})})]}),b&&e.jsx("div",{className:s.modalOverlay,children:e.jsxs("div",{className:s.modal,children:[e.jsxs("div",{className:s.modalHeader,children:[e.jsx("h2",{children:l?"تعديل بيانات العميل":"إضافة عميل جديد"}),e.jsx("button",{className:s.closeButton,onClick:p,children:e.jsx(ne,{size:20})})]}),e.jsxs("form",{onSubmit:Ke,className:s.form,children:[e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{htmlFor:"name",children:"الاسم"}),e.jsx("input",{type:"text",id:"name",name:"name",value:o.name,onChange:g,required:!0,placeholder:"أدخل اسم العميل"})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{htmlFor:"number",children:"رقم الهاتف"}),e.jsx("input",{type:"text",id:"number",name:"number",value:o.number,onChange:g,required:!0,placeholder:"أدخل رقم الهاتف"})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{htmlFor:"source",children:"المصدر"}),e.jsx("select",{id:"source",name:"source",value:o.source,onChange:g,required:!0,children:Object.entries(oe).map(([t,a])=>e.jsx("option",{value:t,children:a},t))})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{htmlFor:"campaign",children:"الcampaign"}),e.jsx("input",{type:"text",id:"campaign",name:"campaign",value:o.campaign,onChange:g,placeholder:"أدخل الcampaign "})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{htmlFor:"address",children:"العنوان"}),e.jsx("input",{type:"text",id:"address",name:"address",value:o.address,onChange:g,placeholder:"أدخل العنوان",required:!0})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{htmlFor:"state",children:"الحالة"}),e.jsx("select",{id:"state",name:"state",value:o.state,onChange:g,required:!0,children:Object.entries(U).map(([t,a])=>e.jsx("option",{value:t,children:a},t))})]}),((pe=A[o.state])==null?void 0:pe.length)>0&&e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{htmlFor:"substate",children:"الحالة الفرعية"}),e.jsx("select",{id:"substate",name:"substate",value:o.substate||"",onChange:g,children:A[o.state].map(t=>e.jsx("option",{value:t,children:re[t]},t))})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{htmlFor:"budget",children:"الميزانية"}),e.jsxs("select",{id:"budget",name:"budget",value:((be=o.budget)==null?void 0:be.toString())||"",onChange:g,children:[e.jsx("option",{value:"",children:"غير محدد"}),ce.map(t=>e.jsx("option",{value:t.value.toString(),children:t.label},t.value))]})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{htmlFor:"notes",children:"ملاحظات"}),e.jsx("textarea",{id:"notes",name:"notes",value:o.notes||"",onChange:g,placeholder:"أدخل ملاحظات (اختياري)",rows:3})]}),e.jsxs("div",{className:s.formActions,children:[e.jsx("button",{type:"button",className:s.cancelButton,onClick:p,disabled:K||X,children:"إلغاء"}),e.jsx("button",{type:"submit",className:s.submitButton,disabled:K||X,children:K||X?e.jsxs(e.Fragment,{children:[e.jsx(R,{isVisible:!0}),e.jsx("span",{children:"جاري الحفظ..."})]}):e.jsx("span",{children:l?"تحديث":"إضافة"})})]})]})]})}),z&&l&&e.jsx("div",{className:s.modalOverlay,children:e.jsxs("div",{className:s.infoModal,children:[e.jsxs("div",{className:`${s.modalHeader} ${s[((Le=l.state)==null?void 0:Le.toLowerCase())+"Header"]}`,children:[e.jsx("h2",{children:"معلومات العميل"}),e.jsx("button",{className:s.closeButton,onClick:p,children:e.jsx(ne,{size:20})})]}),e.jsxs("div",{className:s.infoContent,children:[e.jsxs("div",{className:s.infoSection,children:[e.jsx("h3",{className:s.sectionTitle,children:"المعلومات الأساسية"}),e.jsxs("div",{className:s.infoItem,children:[e.jsx("span",{className:s.infoLabel,children:"الرقم التعريفي:"}),e.jsx("span",{className:s.infoValue,children:l.id})]}),e.jsxs("div",{className:s.infoItem,children:[e.jsx("span",{className:s.infoLabel,children:"الاسم:"}),e.jsx("span",{className:s.infoValue,children:l.name})]}),e.jsxs("div",{className:s.infoItem,children:[e.jsx("span",{className:s.infoLabel,children:"رقم الهاتف:"}),e.jsxs("div",{className:s.phoneActions,children:[e.jsx("span",{className:s.infoValue,children:l.number}),e.jsxs("div",{className:s.phoneButtons,children:[e.jsx("a",{href:`tel:${l.number}`,className:s.callButton,"aria-label":"اتصال",children:e.jsx(ie,{size:16})}),e.jsx("a",{href:`https://wa.me/${l.number.replace(/\+/g,"").replace(/\s/g,"")}`,target:"_blank",rel:"noopener noreferrer",className:s.whatsappButton,"aria-label":"واتساب",children:e.jsx(le,{size:16})})]})]})]}),e.jsxs("div",{className:s.infoItem,children:[e.jsx("span",{className:s.infoLabel,children:"العنوان:"}),e.jsx("span",{className:s.infoValue,children:l.address})]})]}),e.jsxs("div",{className:s.infoSection,children:[e.jsx("h3",{className:s.sectionTitle,children:"حالة العميل"}),e.jsxs("div",{className:s.infoItem,children:[e.jsx("span",{className:s.infoLabel,children:"الحالة:"}),e.jsx("span",{className:`${s.infoValue} ${s[((Ie=l.state)==null?void 0:Ie.toLowerCase())+"State"]}`,children:U[l.state]||l.state})]}),l.substate&&e.jsxs("div",{className:s.infoItem,children:[e.jsx("span",{className:s.infoLabel,children:"الحالة الفرعية:"}),e.jsx("span",{className:s.infoValue,children:re[l.substate]||l.substate})]}),e.jsxs("div",{className:s.infoItem,children:[e.jsx("span",{className:s.infoLabel,children:"المصدر:"}),e.jsx("span",{className:s.infoValue,children:oe[l.source]||l.source})]}),e.jsxs("div",{className:s.infoItem,children:[e.jsx("span",{className:s.infoLabel,children:"الميزانية:"}),e.jsx("span",{className:s.infoValue,children:ra(l.budget)})]})]}),e.jsxs("div",{className:s.infoSection,children:[e.jsx("h3",{className:s.sectionTitle,children:"معلومات إضافية"}),e.jsxs("div",{className:s.infoItem,children:[e.jsx("span",{className:s.infoLabel,children:"مسؤول المبيعات:"}),e.jsx("span",{className:s.infoValue,children:ae(l)})]}),e.jsxs("div",{className:s.infoItem,children:[e.jsx("span",{className:s.infoLabel,children:"تم إنشاؤه بواسطة:"}),e.jsx("span",{className:s.infoValue,children:l.is_created_by_sales?"فريق المبيعات":"النظام"})]}),e.jsxs("div",{className:s.infoItem,children:[e.jsx("span",{className:s.infoLabel,children:"تاريخ الإنشاء:"}),e.jsx("span",{className:s.infoValue,children:Oe(l.created_at.toString())})]}),e.jsxs("div",{className:s.infoItem,children:[e.jsx("span",{className:s.infoLabel,children:"آخر تحديث:"}),e.jsx("span",{className:s.infoValue,children:Oe(l.updated_at.toString())})]})]}),l.notes&&e.jsxs("div",{className:s.infoSection,children:[e.jsx("h3",{className:s.sectionTitle,children:"ملاحظات"}),e.jsx("div",{className:s.notesBox,children:l.notes})]})]}),e.jsxs("div",{className:s.infoActions,children:[e.jsx("button",{className:s.closeInfoButton,onClick:p,children:"إغلاق"}),(n==null?void 0:n.role)=="ADMIN"&&e.jsx(e.Fragment,{children:e.jsx("button",{className:s.editInfoButton,onClick:()=>{p(),se(l)},children:"تعديل"})})]})]})}),W&&e.jsx("div",{className:s.modalOverlay,children:e.jsxs("div",{className:s.modal,children:[e.jsxs("div",{className:s.modalHeader,children:[e.jsx("h2",{children:"تصفية العملاء"}),e.jsx("button",{className:s.closeButton,onClick:p,children:e.jsx(ne,{size:20})})]}),e.jsxs("div",{className:s.filterForm,children:[e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{htmlFor:"salesId",children:"مسؤول المبيعات"}),e.jsxs("select",{id:"salesId",name:"salesId",value:((Se=c.salesId)==null?void 0:Se.toString())||"",onChange:k,children:[e.jsx("option",{value:"",children:"الكل"}),N.filter(t=>t.role.toUpperCase()==="SALES"||t.role.toUpperCase()==="ADMIN").map(t=>e.jsx("option",{value:t.id.toString(),children:t.name},t.id))]})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{htmlFor:"state",children:"الحالة"}),e.jsxs("select",{id:"state",name:"state",value:c.state||"",onChange:k,children:[e.jsx("option",{value:"",children:"الكل"}),Object.entries(U).map(([t,a])=>e.jsx("option",{value:t,children:a},t))]})]}),c.state&&((ge=A[c.state])==null?void 0:ge.length)>0&&e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{htmlFor:"substate",children:"الحالة الفرعية"}),e.jsxs("select",{id:"substate",name:"substate",value:c.substate||"",onChange:k,children:[e.jsx("option",{value:"",children:"الكل"}),A[c.state].map(t=>e.jsx("option",{value:t,children:re[t]},t))]})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{htmlFor:"source",children:"المصدر"}),e.jsxs("select",{id:"source",name:"source",value:c.source||"",onChange:k,children:[e.jsx("option",{value:"",children:"الكل"}),Object.entries(oe).map(([t,a])=>e.jsx("option",{value:t,children:a},t))]})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{htmlFor:"budget",children:"الميزانية"}),e.jsxs("select",{id:"budget",name:"budget",value:((ve=c.budget)==null?void 0:ve.toString())||"",onChange:k,children:[e.jsx("option",{value:"",children:"الكل"}),ce.map(t=>e.jsx("option",{value:t.value.toString(),children:t.label},t.value))]})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{htmlFor:"isCreatedBySales",children:"تم إنشاؤه بواسطة"}),e.jsxs("select",{id:"isCreatedBySales",name:"isCreatedBySales",value:c.isCreatedBySales===null?"":c.isCreatedBySales.toString(),onChange:k,children:[e.jsx("option",{value:"",children:"الكل"}),e.jsx("option",{value:"true",children:"فريق المبيعات"}),e.jsx("option",{value:"false",children:"النظام"})]})]}),e.jsxs("div",{className:s.filterActions,children:[e.jsx("button",{type:"button",className:s.resetFilterButton,onClick:te,children:"إعادة ضبط"}),e.jsx("button",{type:"button",className:s.applyFilterButton,onClick:Ye,children:"تطبيق"})]})]})]})}),q&&l&&e.jsx("div",{className:s.modalOverlay,children:e.jsxs("div",{className:s.transferModal,children:[e.jsx("h2",{children:"تحويل العميل"}),e.jsxs("p",{children:['اختر مسؤول المبيعات الذي تريد تحويل العميل "',l.name,'" إليه.']}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{htmlFor:"transferSalesId",children:"مسؤول المبيعات"}),e.jsxs("select",{id:"transferSalesId",value:(B==null?void 0:B.toString())||"",onChange:t=>de(t.target.value?Number.parseInt(t.target.value):null),required:!0,children:[e.jsx("option",{value:"",children:"اختر مسؤول المبيعات"}),N.filter(t=>t.role.toUpperCase()==="SALES"&&t.id!==l.sales_id).map(t=>e.jsx("option",{value:t.id.toString(),children:t.name},t.id))]})]}),e.jsxs("div",{className:s.transferActions,children:[e.jsx("button",{className:s.cancelButton,onClick:p,disabled:Z,children:"إلغاء"}),e.jsx("button",{className:s.transferConfirmButton,onClick:Je,disabled:Z||!B,children:Z?e.jsxs(e.Fragment,{children:[e.jsx(R,{isVisible:!0}),e.jsx("span",{children:"جاري التحويل..."})]}):e.jsx("span",{children:"تأكيد التحويل"})})]})]})}),F&&l&&e.jsx("div",{className:s.modalOverlay,children:e.jsxs("div",{className:s.confirmModal,children:[e.jsx("h2",{children:"تأكيد الحذف"}),e.jsxs("p",{children:['هل أنت متأكد من رغبتك في حذف العميل "',l.name,'"؟',e.jsx("br",{}),"هذا الإجراء لا يمكن التراجع عنه."]}),e.jsxs("div",{className:s.confirmActions,children:[e.jsx("button",{className:s.cancelButton,onClick:p,disabled:J,children:"إلغاء"}),e.jsx("button",{className:s.deleteConfirmButton,onClick:Xe,disabled:J,children:J?e.jsxs(e.Fragment,{children:[e.jsx(R,{isVisible:!0}),e.jsx("span",{children:"جاري الحذف..."})]}):e.jsx("span",{children:"تأكيد الحذف"})})]})]})})]})};export{pa as default};
